{"version":3,"sources":["../src/navimi.ts"],"names":[],"mappings":"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","file":"navimi.js","sourcesContent":["/*! \r\n * Navimi v0.0.1\r\n * Developed by Ivan Valadares \r\n * ivanvaladares@hotmail.com\r\n * https://github.com/ivanvaladares/navimi\r\n */\r\n\r\ninterface Route {\r\n    title: string;\r\n    jsUrl?: string;\r\n    cssUrl?: string;\r\n    templatesUrl?: string;\r\n    dependsOn?: string[];\r\n    metadata?: { [key: string]: any };\r\n}\r\n\r\ninterface Functions {\r\n    addLibrary: (jsOrCssUrl: string | string[]) => Promise<void>;\r\n    fetchJS: (jsUrl: string | string[]) => Promise<InstanceType<any> | InstanceType<any>[]>;\r\n    fetchTemplate: (templateUrl: string | string[]) => Promise<void | void[]>;\r\n    getState: (key?: string) => any;\r\n    getTemplate: (templateId: string | string[]) => string | string[];\r\n    navigateTo: (url: string, params?: { [key: string]: any }) => void;\r\n    setTitle: (title: string) => void;\r\n    setState: (state: { [key: string]: any }) => void;\r\n    unwatchState: (key?: string | string[]) => void;\r\n    watchState: (key: string, callback: (state: any) => void) => void;\r\n}\r\n\r\ntype Next = () => Promise<void> | void;\r\ntype Context = { url: string, routeItem: Route, params: { [key: string]: any } };\r\ntype Middleware = (context: Context, navigateTo: (url: string, params?: { [key: string]: any }) => void, next: Next) => Promise<void> | void;\r\n\r\ninterface Options {\r\n    globalCssUrl?: string;\r\n    globalTemplatesUrl?: string;\r\n    services?: { [serviceName: string]: string };\r\n    middlewares?: Middleware[];\r\n    hot?: number | boolean;\r\n    onAfterRoute?: (context: Context, navigateTo: (url: string, params?: { [key: string]: any }) => void) => void;\r\n    onBeforeRoute?: (context: Context, navigateTo: (url: string, params?: { [key: string]: any }) => void) => void;\r\n    onError?: (error: Error) => void;\r\n}\r\n\r\nclass Navimi {\r\n\r\n    private controller: AbortController;\r\n    private currentRouteItem: Route;\r\n    private currentJS: string;\r\n    private currentUrl: string;\r\n    private currentParams: { [url: string]: any };\r\n    private routingList: { [url: string]: Route };\r\n    private loadErrors: { [url: string]: any };\r\n    private loadedJs: { [url: string]: boolean };\r\n    private loadedTemplates: { [url: string]: boolean };\r\n    private loadedCsss: { [url: string]: string };\r\n    private templatesCache: { [templateId: string]: string };\r\n    private routesJSs: { [url: string]: InstanceType<any> }\r\n    private routesJSsServices: { [url: string]: string[] }\r\n    private externalJSs: { [url: string]: InstanceType<any> }\r\n    private externalJSsMap: { [url: string]: { [url: string]: boolean } }\r\n    private externalTemplatesMap: { [url: string]: { [url: string]: boolean } }\r\n    private wsHotClient: WebSocket;\r\n    private options: Options;\r\n    private pagesNamespace: string;\r\n    private pagesMainCallBack: string;\r\n    private callbackNS: string;\r\n    private win: any;\r\n    private state: { [key: string]: any };\r\n    private prevState: { [key: string]: any };\r\n    private stateDiff: { [key: string]: boolean };\r\n    private stateWatchers: { [key: string]: any };\r\n    private middlewareStack: Middleware[];\r\n    private callId: number;\r\n\r\n    /**\r\n    * @typedef {Object} Route - An route definition\r\n    * @property {string} routes.title - The title that will be displayed on the browser\r\n    * @property {string} routes.jsUrl - The path to the route script\r\n    * @property {string=} routes.cssUrl - The path to the route css\r\n    * @property {string=} routes.templatesUrl - The path to the templates file of this route \r\n    * @property {string[]=} routes.dependsOn - An array of services names for this route\r\n    * @property {Object.<string, *>=} routes.metadata - Any literal you need to pass down to this route and middlewares \r\n    * @param {Object.<string, Route>} routes - A collection of Route\r\n    * @param {Object} [options] - Navimi options \r\n    * @param {string=} options.globalCssUrl - The path to the global css\r\n    * @param {string=} options.globalTemplatesUrl - The path to the global templates file\r\n    * @param {Object.<string, string>=} options.services - A collection of all services {[service name]: script path}\r\n    * @param {((context: Object.<string, *>, navigateTo: (url: string, params?: Object.<string, *>) => void, next:() => void) => void)[]=} options.middlewares - An array of functions to capture the request\r\n    * @param {(number | boolean)=} options.hot - The port to the websocket at localhost\r\n    * @param {((context: Object.<string, *>, navigateTo: (url: string, params?: Object.<string, *>) => void)=} options.onAfterRoute - A function invoked after the routing is done\r\n    * @param {((context: Object.<string, *>, navigateTo: (url: string, params?: Object.<string, *>) => void)=} options.onBeforeRoute - A function invoked before middlewares and routing\r\n    * @param {function(Error): void=} options.onError - A function to capture erros from routes\r\n    * @returns {Object} - The Navimi instance \r\n    */\r\n    constructor(routes: { [url: string]: Route }, options?: Options) {\r\n\r\n        this.pagesNamespace = \"__spaPages\";\r\n        this.pagesMainCallBack = \"_mainCallback\";\r\n        this.callbackNS = \"_callback_\";\r\n        this.win = window ? window : {};\r\n        this.controller = new AbortController();\r\n        this.currentRouteItem = undefined;\r\n        this.currentJS = undefined;\r\n        this.currentUrl = undefined;\r\n        this.currentParams = {};\r\n        this.routesJSs = {};\r\n        this.routesJSsServices = {};\r\n        this.externalJSs = {};\r\n        this.externalJSsMap = {};\r\n        this.externalTemplatesMap = {};\r\n        this.routingList = routes || {};\r\n        this.loadErrors = {};\r\n        this.loadedCsss = {};\r\n        this.loadedJs = {};\r\n        this.loadedTemplates = {};\r\n        this.templatesCache = {};\r\n        this.options = options || {};\r\n        this.state = {};\r\n        this.prevState = {};\r\n        this.stateDiff = {};\r\n        this.stateWatchers = {};\r\n        this.middlewareStack = [];\r\n        this.callId = 0;\r\n\r\n        //@ts-ignore\r\n        this.win.addEventListener('popstate', () => {\r\n            this.initRoute();\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.win.navigateTo = this.navigateTo;\r\n\r\n        // initialize JS loader namespace\r\n        this.win[this.pagesNamespace] = {};\r\n\r\n        //add middlewares\r\n        const middlewares = this.options.middlewares;\r\n        if (Array.isArray(middlewares)) {\r\n            this.middlewareStack.push(...middlewares.filter(mdw => mdw !== undefined));\r\n        }\r\n\r\n        (async () => {\r\n            if (this.options.globalCssUrl || this.options.globalTemplatesUrl) {\r\n                await Promise.all([\r\n                    this.fetchCss(this.options.globalCssUrl, true),\r\n                    this.fetchTemplate(false, [this.options.globalTemplatesUrl]),\r\n                ]).catch(this.reportError);\r\n                this.insertCss(this.loadedCsss[this.options.globalCssUrl], \"globalCss\");\r\n            }\r\n        })();\r\n\r\n        this.initRoute();\r\n\r\n        if (this.options.hot && 'WebSocket' in this.win) {\r\n            setTimeout(this.openHotWs, 1000, this.options.hot);\r\n        }\r\n    }\r\n\r\n    private timeout = (ms: number): Promise<void> => {\r\n        return new Promise(resolve => setTimeout(resolve, ms));\r\n    };\r\n\r\n    private debounce = (task: (args: any[]) => any, ms: number): () => void => {\r\n        let timeout: any;\r\n        return function () {\r\n            const func = (): void => {\r\n                timeout = null;\r\n                task.apply(this, arguments);\r\n            };\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(func, ms);\r\n        };\r\n    };\r\n\r\n    private setNavimiLinks = (): void => {\r\n        document.querySelectorAll(\"[navimi-link]\").forEach(el => {\r\n            el.removeAttribute(\"navimi-link\");\r\n            el.setAttribute(\"navimi-linked\", \"\");\r\n            el.addEventListener('click', (e: any) => {\r\n                e.preventDefault();\r\n                this.navigateTo(e.target.pathname);\r\n            });\r\n        });\r\n    }\r\n\r\n    private navigateTo = (url: string, params?: { [key: string]: any }): void => {\r\n        this.initRoute(url, params);\r\n    };\r\n\r\n    private setTitle = (title: string): void => {\r\n        document.title = title;\r\n    };\r\n\r\n    private getUrl = (): string => {\r\n        const location = document.location;\r\n        const matches = location.toString().match(/^[^#]*(#.+)$/);\r\n        const hash = matches ? matches[1] : \"\";\r\n        return [location.pathname, location.search, hash].join(\"\");\r\n    };\r\n\r\n    private splitPath = (path: string): string[] => {\r\n        if (!path) {\r\n            return [];\r\n        }\r\n\r\n        const queryPos = path.indexOf(\"?\");\r\n        path = queryPos >= 0 ? path.substr(0, queryPos) : path;\r\n\r\n        return path.split(\"/\").filter(p => p.length > 0);\r\n    };\r\n\r\n    private removeHash = (url: string): string => {\r\n        const hashPos = url.indexOf(\"#\");\r\n        return hashPos > 0 ? url.substr(0, hashPos) : url;\r\n    };\r\n\r\n    private parseQuery = (queryString: string): { [key: string]: string } => {\r\n        const query: { [key: string]: string } = {};\r\n        queryString.split('&').map(pair => {\r\n            const kv = pair.split('=');\r\n            query[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1] || '');\r\n        });\r\n        return query;\r\n    };\r\n\r\n    private parsePath = (urlPath: string, urlPattern: string): { [key: string]: any } => {\r\n        const queryPos = urlPath.indexOf(\"?\");\r\n        const query = queryPos > 0 ? urlPath.substr(queryPos + 1, urlPath.length) : \"\";\r\n        const path = this.splitPath(urlPath);\r\n        const pattern = this.splitPath(urlPattern);\r\n\r\n        let params: any = {};\r\n\r\n        if (queryPos > 0) {\r\n            params = {\r\n                queryString: this.parseQuery(query)\r\n            };\r\n        }\r\n\r\n        for (let i = 0; i < pattern.length; i++) {\r\n            if (pattern[i].charAt(0) === ':') {\r\n                const name = pattern[i].slice(1);\r\n                if (path.length <= i) {\r\n                    return null;\r\n                }\r\n                params[name] = decodeURIComponent(path[i]);\r\n            }\r\n            else {\r\n                if (!path[i] || pattern[i].toLocaleLowerCase() !== path[i].toLocaleLowerCase())\r\n                    return null;\r\n            }\r\n        }\r\n\r\n        return params;\r\n    };\r\n\r\n    private getStateDiff = (keys: string[]): void => {\r\n        keys.sort((a, b) => b.length - a.length).map(key => {\r\n            if (!this.stateDiff[key]) {\r\n                const sOld = JSON.stringify(this.getState(key, this.prevState) || \"\");\r\n                const sNew = JSON.stringify(this.getState(key, this.state) || \"\");\r\n                if (sOld !== sNew) {\r\n                    this.stateDiff[key] = true;\r\n                    //set upper keys as changed so we don't test them again\r\n                    keys.map(upperKey => {\r\n                        if (key !== upperKey && key.indexOf(upperKey) === 0) {\r\n                            this.stateDiff[upperKey] = true;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    private invokeStateWatchers = this.debounce((): void => {\r\n        const keys = Object.keys(this.stateWatchers);\r\n        const diff = Object.keys(this.stateDiff);\r\n        this.stateDiff = {};\r\n        keys.filter(key => diff.includes(key)).sort((a, b) => b.length - a.length).map(key => {\r\n            Object.keys(this.stateWatchers[key]).map((cs: string) => {\r\n                const sNew = this.getState(key);\r\n                this.stateWatchers[key][cs] &&\r\n                    this.stateWatchers[key][cs].map((cb: (state: any) => void) => cb && cb(sNew));\r\n            });\r\n        });\r\n    }, 10);\r\n\r\n\r\n    private mergeState(state: any, newState: any): void {\r\n        const isObject = (item: any): boolean =>\r\n            item && typeof item === 'object' && !Array.isArray(item) && item !== null;\r\n        if (isObject(state) && isObject(newState)) {\r\n            for (const key in newState) {\r\n                if (isObject(newState[key])) {\r\n                    !state[key] && Object.assign(state, { [key]: {} });\r\n                    this.mergeState(state[key], newState[key]);\r\n                } else {\r\n                    Object.assign(state, { [key]: newState[key] });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private setState = (newState: { [key: string]: any }): void => {\r\n        const observedKeys = Object.keys(this.stateWatchers);\r\n        if (observedKeys.length > 0) {\r\n            this.prevState = JSON.parse(JSON.stringify(this.state));\r\n        }\r\n        this.mergeState(this.state, newState);\r\n        if (observedKeys.length > 0) {\r\n            this.getStateDiff(observedKeys);\r\n            this.invokeStateWatchers();\r\n        }\r\n    };\r\n\r\n    private getState = (key?: string, state?: any): { [key: string]: any } => {\r\n        const st = key ?\r\n            key.split('.').reduce((v, k) => (v && v[k]) || undefined, state || this.state) :\r\n            state || this.state;\r\n        return st ? Object.freeze(JSON.parse(JSON.stringify(st))) : undefined;\r\n    };\r\n\r\n    private watchState = (jsUrl: string, key: string, callback: (state: any) => void): void => {\r\n        if (!key || !callback) {\r\n            return;\r\n        }\r\n        if (!this.stateWatchers[key]) {\r\n            this.stateWatchers[key] = {};\r\n        }\r\n        this.stateWatchers[key] = {\r\n            ...this.stateWatchers[key],\r\n            [jsUrl]: [\r\n                ...(this.stateWatchers[key][jsUrl] || []),\r\n                callback\r\n            ]\r\n        };\r\n    };\r\n\r\n    private unwatchState = (jsUrl: string, key?: string | string[]): void => {\r\n        const remove = (key: string): void => {\r\n            this.stateWatchers[key][jsUrl] = undefined;\r\n            delete this.stateWatchers[key][jsUrl];\r\n            Object.keys(this.stateWatchers[key]).length === 0 &&\r\n                delete this.stateWatchers[key];\r\n        }\r\n\r\n        if (key) {\r\n            const keys = Array.isArray(key) ? key : [key];\r\n            keys.map(id => {\r\n                !this.stateWatchers[id] && (this.stateWatchers[id] = {});\r\n                remove(id);\r\n            });\r\n            return;\r\n        }\r\n\r\n        Object.keys(this.stateWatchers).map(remove);\r\n    };\r\n\r\n    private reportError = (error: string): void => {\r\n        if (this.options.onError) {\r\n            this.options.onError(Error(error));\r\n            return;\r\n        }\r\n        console.error(error);\r\n    }\r\n\r\n    private openHotWs = (hotOption: number | boolean): void => {\r\n        try {\r\n            console.log(\"Connecting HOT...\");\r\n            const port = hotOption === true ? 8080 : hotOption;\r\n            this.wsHotClient = null;\r\n            this.wsHotClient = new WebSocket(`ws://localhost:${port}`);\r\n            this.wsHotClient.addEventListener('message', (e: any) => {\r\n                try {\r\n                    const json: any = JSON.parse(e.data || \"\");\r\n                    if (json.message) {\r\n                        console.log(json.message);\r\n                        return;\r\n                    }\r\n                    if (json.filePath) {\r\n                        this.digestHot(json);\r\n                    }\r\n                } catch (ex) {\r\n                    console.error(\"Could not parse HOT message:\", ex);\r\n                }\r\n            });\r\n            this.wsHotClient.onclose = () => {\r\n                console.warn('HOT Connection Closed!');\r\n                setTimeout(this.openHotWs, 5000, hotOption);\r\n            };\r\n        } catch (ex) {\r\n            console.error(ex);\r\n        }\r\n    };\r\n\r\n    private digestHot = (file: any): void => {\r\n        const isSameFile = (path1: string, path2: string) => {\r\n            return path1 && path2 && path1.split(\"?\").shift().toLocaleLowerCase() ==\r\n                path2.split(\"?\").shift().toLocaleLowerCase();\r\n        }\r\n\r\n        try {\r\n            const filePath = file.filePath.replace(/\\\\/g, \"/\");\r\n            const pages: any = this.win[this.pagesNamespace];\r\n\r\n            if (isSameFile(this.options.globalCssUrl, filePath)) {\r\n                console.log(`${file.filePath} updated.`);\r\n                this.loadedCsss[file.filePath] = file.data;\r\n                this.insertCss(file.data, \"globalCss\");\r\n                return;\r\n            }\r\n\r\n            if (this.currentJS && isSameFile(this.options.globalTemplatesUrl, filePath)) {\r\n                console.log(`${file.filePath} updated.`);\r\n                this.parseTemplate(file.data, this.options.globalTemplatesUrl);\r\n                this.initJS(this.currentJS);\r\n                this.setNavimiLinks();\r\n                return;\r\n            }\r\n\r\n            if (this.currentJS && this.externalJSsMap[filePath]) {\r\n                console.log(`${file.filePath} updated.`);\r\n                pages[this.callbackNS + filePath] = () => {\r\n                    Object.keys(this.externalJSsMap[filePath]).map(s => {\r\n                        this.routesJSs[s] = undefined;\r\n                        if (s === this.currentJS) {\r\n                            this.initRoute(undefined, undefined, true);\r\n                        }\r\n                    });\r\n                };\r\n                this.insertJS(file.data, filePath, true);\r\n                return;\r\n            }\r\n\r\n            if (this.currentJS && this.externalTemplatesMap[filePath]) {\r\n                console.log(`${file.filePath} updated.`);\r\n                this.parseTemplate(file.data);\r\n                Object.keys(this.externalTemplatesMap[filePath])\r\n                    .find(s => s === this.currentJS) &&\r\n                    this.initJS(this.currentJS);\r\n                return;\r\n            }\r\n\r\n            for (const routeUrl in this.routingList) {\r\n                const routeItem = this.routingList[routeUrl];\r\n\r\n                if (this.currentJS && isSameFile(routeItem.jsUrl, filePath)) {\r\n                    if (this.routesJSs[routeItem.jsUrl]) {\r\n                        console.log(`${file.filePath} updated.`);\r\n                        this.routesJSs[routeItem.jsUrl] = undefined;\r\n                        pages[this.callbackNS + routeItem.jsUrl] = () => {\r\n                            this.currentJS === routeItem.jsUrl &&\r\n                                this.initJS(this.currentJS);\r\n                        };\r\n                        this.insertJS(file.data, routeItem.jsUrl, false);\r\n                        this.setNavimiLinks();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                if (isSameFile(routeItem.cssUrl, filePath)) {\r\n                    console.log(`${file.filePath} updated.`);\r\n                    this.loadedCsss[routeItem.cssUrl] = file.data;\r\n                    (this.currentJS && this.currentJS === routeItem.jsUrl ||\r\n                        routeItem.cssUrl === this.currentRouteItem.cssUrl) &&\r\n                            this.insertCss(file.data, \"pageCss\");\r\n                    return;\r\n                }\r\n\r\n                if (isSameFile(routeItem.templatesUrl, filePath)) {\r\n                    console.log(`${file.filePath} updated.`);\r\n                    this.parseTemplate(file.data, routeItem.templatesUrl);\r\n                    (this.currentJS && this.currentJS === routeItem.jsUrl  ||\r\n                        routeItem.templatesUrl === this.currentRouteItem.templatesUrl) &&\r\n                            this.initJS(this.currentJS);\r\n                    this.setNavimiLinks();\r\n                    return;\r\n                }\r\n            }\r\n\r\n        } catch (ex) {\r\n            console.error(\"Could not digest HOT message: \", ex);\r\n        }\r\n    };\r\n\r\n    private fetchFile = (url: string, options?: RequestInit): Promise<string> => {\r\n        return new Promise((resolve, reject) => {\r\n            delete this.loadErrors[url];\r\n            //todo: add retry\r\n            fetch(url, options)\r\n                .then(async (data) => {\r\n                    if (!data || !data.ok) {\r\n                        const error = `Could not load the file! - ${url}`;\r\n                        this.loadErrors[url] = error;\r\n                        return reject(error);\r\n                    }\r\n                    resolve(await data.text());\r\n                })\r\n                .catch(ex => {\r\n                    this.loadErrors[url] = ex.message;\r\n                    reject(ex);\r\n                });\r\n        });\r\n    };\r\n\r\n    private parseTemplate = (templateCode: string, url?: string): void => {\r\n        const regIni = new RegExp(\"<t ([^>]+)>\");\r\n        const regEnd = new RegExp(\"</t>\");\r\n        const regId = new RegExp(\"id=\\\"([^\\\"]+)\\\"\");\r\n        let tempCode = templateCode;\r\n\r\n        if (!regIni.exec(tempCode)) {\r\n            this.templatesCache[url] = tempCode;\r\n            return;\r\n        }\r\n\r\n        while (templateCode && templateCode.length > 0) {\r\n            const iniTemplate = regIni.exec(tempCode);\r\n\r\n            if (!iniTemplate || iniTemplate.length === 0) {\r\n                break;\r\n            }\r\n\r\n            const regIdRes = regId.exec(iniTemplate[1]);\r\n            const idTemplate = regIdRes.length > 0 && regIdRes[1];\r\n            tempCode = tempCode.substr(iniTemplate.index + iniTemplate[0].length);\r\n            const endTemplate = regEnd.exec(tempCode);\r\n\r\n            if (!idTemplate || !endTemplate || endTemplate.length === 0) {\r\n                break;\r\n            }\r\n\r\n            this.templatesCache[idTemplate] = tempCode.substr(0, endTemplate.index);\r\n        }\r\n    };\r\n\r\n    private fetchTemplate = (isCancelable: boolean, urls: string[]): Promise<void | void[]> => {\r\n        const init = (url: string): Promise<void> => {\r\n            return new Promise(async (resolve, reject) => {\r\n                if (!url || this.loadedTemplates[url]) {\r\n                    return resolve();\r\n                }\r\n                try {\r\n                    const templateCode = await this.fetchFile(url, {\r\n                        headers: {\r\n                            Accept: \"text/html\"\r\n                        },\r\n                        signal: isCancelable ? this.controller.signal : undefined\r\n                    });\r\n\r\n                    this.parseTemplate(templateCode, url);\r\n                    this.loadedTemplates[url] = true;\r\n                    resolve();\r\n\r\n                } catch (ex) {\r\n                    reject(ex);\r\n                }\r\n            });\r\n        };\r\n        return urls.length > 1 ? Promise.all(urls.map(init)) : init(urls[0]);\r\n    };\r\n\r\n    private fetchCss = (url: string, isGlobal?: boolean, autoInsert?: boolean): Promise<void | void[]> => {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            if (!url || this.loadedCsss[url]) {\r\n                return resolve();\r\n            }\r\n            try {\r\n                const cssCode = await this.fetchFile(url, {\r\n                    headers: {\r\n                        Accept: \"text/css\"\r\n                    },\r\n                    signal: isGlobal ? undefined : this.controller.signal\r\n                });\r\n\r\n                if (autoInsert) {\r\n                    this.insertCss(cssCode, undefined, true);\r\n                    this.loadedCsss[url] = \"loaded\";\r\n                } else {\r\n                    this.loadedCsss[url] = cssCode;\r\n                }\r\n                resolve();\r\n\r\n            } catch (ex) {\r\n                reject(ex);\r\n            }\r\n        });\r\n    };\r\n\r\n    private fetchJS = (url: string, external?: boolean): Promise<void | void[]> => {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            try {\r\n                const jsCode = await this.fetchFile(url, {\r\n                    headers: {\r\n                        Accept: \"application/javascript\"\r\n                    },\r\n                    signal: this.controller.signal\r\n                });\r\n\r\n                this.loadedJs[url] = true;\r\n                this.insertJS(jsCode, url, external);\r\n                resolve();\r\n\r\n            } catch (ex) {\r\n                reject(ex);\r\n            }\r\n        });\r\n    };\r\n\r\n    private addLibrary = async (jsOrCssUrl: string | string[]): Promise<void> => {\r\n        let urls = Array.isArray(jsOrCssUrl) ? jsOrCssUrl : [jsOrCssUrl];\r\n        urls = urls.filter(url => !this.loadedJs[url]);\r\n\r\n        urls.length > 0 && await Promise.all(urls.map(url => {\r\n            const type = url.split(\".\").pop();\r\n            if (type.toLocaleLowerCase() === \"css\") {\r\n                return this.fetchCss(url, false, true);\r\n            }\r\n            return this.fetchJS(url)\r\n        })).catch(ex => {\r\n            throw new Error(ex)\r\n        });\r\n\r\n        return;\r\n    };\r\n\r\n    private insertCss = (cssCode: string, type?: string, prepend?: boolean): void => {\r\n        const oldTag = type ? document.querySelector(`[${type}]`) : undefined;\r\n        oldTag && oldTag.remove();\r\n        if (!cssCode) {\r\n            return;\r\n        }\r\n        const style: HTMLStyleElement = document.createElement(\"style\");\r\n        style.innerHTML = cssCode;\r\n        type && style.setAttribute(type, \"\");\r\n        const head = document.getElementsByTagName(\"head\")[0];\r\n        const target = (head || document.body);\r\n        prepend ? target.prepend(style) : target.appendChild(style);\r\n    };\r\n\r\n    private insertJS = (jsCode: string, jsUrl: string, external?: boolean): void => {\r\n        const oldTag = document.querySelector(`[jsUrl='${jsUrl}']`);\r\n        oldTag && oldTag.remove();\r\n\r\n        let jsHtmlBody = external !== undefined ?\r\n            `(function(){window.${this.pagesNamespace}.${this.pagesMainCallBack}(\"${jsUrl}\", ${external}, (function(){return ${jsCode}   \r\n    })())}())` : jsCode;\r\n\r\n        const script: HTMLScriptElement = document.createElement(\"script\");\r\n        script.type = \"text/javascript\";\r\n        script.innerHTML = jsHtmlBody;\r\n        script.setAttribute(\"jsUrl\", jsUrl);\r\n        const head = document.getElementsByTagName(\"head\")[0];\r\n        (head || document.body).appendChild(script);\r\n    };\r\n\r\n    private getTemplate = (templateId: string | string[]): string | string[] => {\r\n        const ids = Array.isArray(templateId) ? templateId : [templateId];\r\n        const arrTemplates = ids.map(id => this.templatesCache[id]);\r\n        return arrTemplates.length > 1 ? arrTemplates : arrTemplates[0];\r\n    };\r\n\r\n    private executeMiddlewares = async (context: Context, callId: number): Promise<void> => {\r\n        let prevIndex = -1;\r\n        const runner = async (index: number, resolve: any, reject: any): Promise<void> => {\r\n            if (index === prevIndex) {\r\n                throw new Error('next() called multiple times')\r\n            }\r\n            prevIndex = index;\r\n            const middleware = this.middlewareStack[index];\r\n            if (middleware) {\r\n                let didNext = false;\r\n                await middleware(context, this.navigateTo, () => {\r\n                    didNext = true;\r\n                    if (callId === this.callId) {\r\n                        runner(index + 1, resolve, reject);\r\n                    }\r\n                });\r\n                if (!didNext) {\r\n                    reject();\r\n                }\r\n            } else {\r\n                resolve();\r\n            }\r\n        }\r\n        await new Promise(async (resolve, reject) => {\r\n            await runner(0, resolve, reject);\r\n        });\r\n    };\r\n\r\n    private setupRoute = async (routeItem: Route): Promise<InstanceType<any>> => {\r\n        const pages: any = this.win[this.pagesNamespace];\r\n\r\n        const instantiateJS = async (jsUrl: string, external: boolean, JsClass: InstanceType<any>) => {\r\n            //remove callbacks\r\n            setTimeout(() => {\r\n                delete pages[this.callbackNS + jsUrl];\r\n                delete pages[this.callbackNS + jsUrl + \"_reject\"];\r\n            }, 1000);\r\n\r\n            if (external) {\r\n                //keep this instance to reuse later\r\n                this.externalJSs[jsUrl] = JsClass;\r\n                return Object.freeze(JsClass);\r\n            }\r\n\r\n            const routerFunctions = Object.freeze({\r\n                addLibrary: this.addLibrary,\r\n                setTitle: this.setTitle,\r\n                navigateTo: this.navigateTo,\r\n                getTemplate: this.getTemplate,\r\n                fetchJS: (url: string | string[]) => {\r\n                    const urls = Array.isArray(url) ? url : [url];\r\n                    urls.map(u => {\r\n                        this.externalJSsMap[u] = {\r\n                            ...this.externalJSsMap[u] || {},\r\n                            [jsUrl]: true\r\n                        };\r\n                    });\r\n                    return fetchJS(true, urls);\r\n                },\r\n                fetchTemplate: (url: string) => {\r\n                    const urls: string[] = Array.isArray(url) ? url : [url];\r\n                    urls.map((u: string) => {\r\n                        this.externalTemplatesMap[u] = {\r\n                            ...this.externalTemplatesMap[u] || {},\r\n                            [jsUrl]: true\r\n                        };\r\n                    });\r\n                    return this.fetchTemplate(true, urls);\r\n                },\r\n                setState: this.setState,\r\n                getState: this.getState,\r\n                unwatchState: (key: string) => this.unwatchState(jsUrl, key),\r\n                watchState: (key: string, callback: (state: any) => void) =>\r\n                    this.watchState(jsUrl, key, callback),\r\n            });\r\n\r\n            let services: { [serviceName: string]: InstanceType<any> };\r\n\r\n            if (this.routesJSsServices[jsUrl].length > 0) {\r\n                while (true) {\r\n                    if (this.routesJSsServices[jsUrl].map((sn: string) =>\r\n                        this.externalJSs[this.options.services[sn]] === undefined).indexOf(true) === -1) {\r\n                        break;\r\n                    }\r\n                    if (this.routesJSsServices[jsUrl].map(sn =>\r\n                        this.options.services[sn]).find(su => this.loadErrors[su])) {\r\n                        return;\r\n                    }\r\n                    await this.timeout(10);\r\n                }\r\n\r\n                this.routesJSsServices[jsUrl].map((sn: string) => {\r\n                    services = {\r\n                        ...services,\r\n                        [sn]: this.externalJSs[this.options.services[sn]]\r\n                    };\r\n                });\r\n            }\r\n\r\n            try {\r\n                this.unwatchState(jsUrl);\r\n                let jsInstance = new JsClass(routerFunctions, services);\r\n                //keep this instance to reuse later\r\n                this.routesJSs[jsUrl] = jsInstance;\r\n                return jsInstance;\r\n\r\n            } catch (error) {\r\n                pages[this.callbackNS + jsUrl + \"_reject\"](error);\r\n            }\r\n\r\n        };\r\n\r\n        const awaitJS = (jsUrl: string) => {\r\n            return new Promise<InstanceType<any>>((resolve, reject) => {\r\n\r\n                const loadInterval = setInterval(() => {\r\n                    if (this.routesJSs[jsUrl]) {\r\n                        clearInterval(loadInterval);\r\n                        return resolve(this.routesJSs[jsUrl]);\r\n                    }\r\n                    if (pages[this.callbackNS + jsUrl] === undefined) {\r\n                        clearInterval(loadInterval);\r\n                        return reject(`Error loading file! ${jsUrl}`);\r\n                    }\r\n                }, 50);\r\n\r\n            });\r\n        };\r\n\r\n        const fetchJS = (external: boolean, urls: string[]): Promise<InstanceType<any> | InstanceType<any>[]> => {\r\n            const init = (url: string): Promise<InstanceType<any>> => {\r\n                return new Promise<InstanceType<any>>(async (resolve, reject) => {\r\n                    // return the instance if this js is already loaded\r\n                    if (external) {\r\n                        if (this.externalJSs[url]) {\r\n                            return resolve(this.externalJSs[url]);\r\n                        }\r\n                    } else {\r\n                        if (this.routesJSs[url]) {\r\n                            return resolve(this.routesJSs[url]);\r\n                        }\r\n                    }\r\n\r\n                    // route repeated calls to an awaiter\r\n                    if (pages[this.callbackNS + url]) {\r\n                        await awaitJS(url)\r\n                            .then(resolve)\r\n                            .catch(reject);\r\n                        return;\r\n                    }\r\n\r\n                    // let the js resolve the promise itself (*1)\r\n                    pages[this.callbackNS + url] = resolve;\r\n                    pages[this.callbackNS + url + \"_reject\"] = reject;\r\n\r\n                    this.fetchJS(url, external).catch(ex => {\r\n                        delete pages[this.callbackNS + url];\r\n                        pages[this.callbackNS + url + \"_reject\"](ex);\r\n                    });\r\n                });\r\n            }\r\n\r\n            return urls.length > 1 ? Promise.all(urls.map(init)) : init(urls[0]);\r\n        };\r\n\r\n        // setup main callback\r\n        if (!pages[this.pagesMainCallBack]) {\r\n            // create the function to be called from the loaded js\r\n            pages[this.pagesMainCallBack] = (jsUrl: string, external: boolean, JsClass: InstanceType<any>) => {\r\n                // resolve the promise (*2)\r\n                pages[this.callbackNS + jsUrl](instantiateJS(jsUrl, external, JsClass));\r\n            };\r\n        }\r\n\r\n        const { jsUrl, cssUrl, templatesUrl, dependsOn } = routeItem;\r\n\r\n        this.fetchCss(cssUrl).catch(_ => { });\r\n        this.fetchTemplate(true, [templatesUrl]).catch(_ => { });\r\n\r\n        if (!jsUrl) {\r\n            return;\r\n        }\r\n\r\n        this.routesJSsServices[jsUrl] = this.routesJSsServices[jsUrl] || [];\r\n\r\n        if (dependsOn && dependsOn.length > 0) {\r\n            let notFoundServices: string[] = [];\r\n            const servicesUrls = dependsOn.map(sn => {\r\n                const su: string = this.options.services[sn];\r\n                if (su === undefined) {\r\n                    notFoundServices.push(sn);\r\n                } else {\r\n                    this.routesJSsServices[jsUrl].indexOf(sn) === -1 &&\r\n                        this.routesJSsServices[jsUrl].push(sn);\r\n                    this.externalJSsMap[su] = {\r\n                        ...this.externalJSsMap[su] || {},\r\n                        [jsUrl]: true\r\n                    };\r\n                }\r\n                return su;\r\n            });\r\n            if (notFoundServices.length > 0) {\r\n                this.reportError(\"Service(s) not defined: \" + notFoundServices.join(\", \"));\r\n                return;\r\n            }\r\n            Promise.all(servicesUrls.filter(su => su !== undefined)\r\n                .map(su => fetchJS(true, [su])))\r\n                .catch(this.reportError);\r\n        }\r\n\r\n        return fetchJS(false, [jsUrl]);\r\n    };\r\n\r\n    private initRoute = async (urlToGo?: string, navParams?: { [key: string]: any }, force?: boolean): Promise<void> => {\r\n        const url = this.removeHash(urlToGo || this.getUrl());\r\n\r\n        if (!force) {\r\n            if (this.currentUrl === url) {\r\n                return;\r\n            }\r\n            this.controller.abort();\r\n            this.controller = new AbortController();\r\n        }\r\n\r\n        const callId = ++this.callId;\r\n        const pushState = urlToGo !== undefined;\r\n        const urlParams = this.splitPath(url);\r\n        let routeItem;\r\n        let params;\r\n\r\n        for (const routeUrl in this.routingList) {\r\n            const routeParams = this.splitPath(routeUrl);\r\n\r\n            if (routeParams.length === urlParams.length) {\r\n                params = this.parsePath(url, routeUrl);\r\n                if (params) {\r\n                    routeItem = this.routingList[routeUrl];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        const catchAll = this.routingList[\"*\"];\r\n        if (!routeItem && catchAll) {\r\n            routeItem = catchAll;\r\n        }\r\n\r\n        if (navParams !== undefined) {\r\n            params = {\r\n                ...params,\r\n                ...navParams\r\n            };\r\n        }\r\n\r\n        this.options.onBeforeRoute && \r\n            await this.options.onBeforeRoute({ url, routeItem, params }, this.navigateTo);\r\n\r\n        if (this.currentJS && !force) {\r\n            const beforeLeave = this.routesJSs[this.currentJS] &&\r\n                this.routesJSs[this.currentJS].beforeLeave;\r\n            if (beforeLeave) {\r\n                if (beforeLeave({ url, routeItem, params }) === false) {\r\n                    if (!pushState) {\r\n                        history.forward();\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n            this.routesJSs[this.currentJS] &&\r\n                this.routesJSs[this.currentJS].destroy &&\r\n                this.routesJSs[this.currentJS].destroy();\r\n        }\r\n\r\n        if (!routeItem) {\r\n            callId === this.callId && this.reportError(\"No route match for url: \" + url);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await this.executeMiddlewares({ url, routeItem, params }, callId);\r\n        } catch (error) {\r\n            return;\r\n        }\r\n\r\n        if (callId < this.callId) {\r\n            return;\r\n        }\r\n\r\n        this.currentRouteItem = routeItem;\r\n        this.currentUrl = url;\r\n\r\n        try {\r\n\r\n            const { title, jsUrl, cssUrl, templatesUrl } = routeItem || {};\r\n\r\n            if (!jsUrl && !templatesUrl) {\r\n                throw new Error(\"The route must define the 'jsUrl' or 'templatesUrl'!\");\r\n            }\r\n\r\n            if (jsUrl) {\r\n                this.currentJS = jsUrl;\r\n                this.currentParams[jsUrl] = { url, routeItem, params };\r\n            }\r\n\r\n            if (pushState) {\r\n                history.pushState(null, null, urlToGo);\r\n            }\r\n\r\n            await this.setupRoute(routeItem);\r\n\r\n            //wait css and template to load if any\r\n            while ((cssUrl && !this.loadedCsss[cssUrl]) ||\r\n                (templatesUrl && !this.loadedTemplates[templatesUrl]) ||\r\n                (this.options.globalCssUrl &&\r\n                    !this.loadedCsss[this.options.globalCssUrl]) ||\r\n                (this.options.globalTemplatesUrl &&\r\n                    !this.loadedTemplates[this.options.globalTemplatesUrl])) {\r\n\r\n                await this.timeout(10);\r\n                if (callId < this.callId) {\r\n                    return;\r\n                }\r\n                if ((cssUrl && this.loadErrors[cssUrl]) ||\r\n                    (templatesUrl && this.loadErrors[templatesUrl]) ||\r\n                    (this.options.globalCssUrl &&\r\n                        this.loadErrors[this.options.globalCssUrl]) ||\r\n                    (this.options.globalTemplatesUrl &&\r\n                        this.loadErrors[this.options.globalTemplatesUrl])) {\r\n                    this.reportError(\r\n                        this.loadErrors[cssUrl] ||\r\n                        this.loadErrors[templatesUrl] ||\r\n                        this.loadErrors[this.options.globalCssUrl] ||\r\n                        this.loadErrors[this.options.globalTemplatesUrl]);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this.setTitle(title);\r\n            await this.initJS(jsUrl);\r\n\r\n            if (callId < this.callId) {\r\n                return;\r\n            }\r\n\r\n            this.setNavimiLinks();\r\n            this.insertCss(this.loadedCsss[cssUrl], \"pageCss\");\r\n\r\n            this.options.onAfterRoute && \r\n                this.options.onAfterRoute({ url, routeItem, params }, this.navigateTo);\r\n\r\n        } catch (ex) {\r\n            callId === this.callId && this.reportError(ex.message);\r\n        }\r\n    };\r\n\r\n    private initJS = async (jsUrl: string): Promise<void> => {\r\n        if (!jsUrl) {\r\n            const url = this.currentRouteItem ? this.currentRouteItem.templatesUrl : null;\r\n            const template = this.getTemplate(url) as string;\r\n            const body = document.querySelector(\"body\");\r\n            if (template && body) {\r\n                body.innerHTML = template;\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.routesJSs[jsUrl] &&\r\n            this.routesJSs[jsUrl].init &&\r\n            await this.routesJSs[jsUrl].init(this.currentParams[jsUrl]);\r\n    };\r\n}"]}