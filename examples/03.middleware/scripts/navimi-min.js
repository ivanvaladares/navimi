var __Navimi_CSSs,__Navimi_Dom,__Navimi_Fetch,__Navimi_Helpers,__Navimi_Hot,__Navimi_JSs,__Navimi_Middleware,__Navimi_State,__Navimi_Templates;!function(e){const t={};e.isCssLoaded=(e=>void 0!==t[e]),e.getCss=(e=>t[e]),e.fetchCss=((e,i,s)=>new Promise(async(r,o)=>{if(!i||t[i])return r();try{const a=await __Navimi_Fetch.fetchFile(i,{headers:{Accept:"text/css"},signal:e?e.signal:void 0});s?(__Navimi_Dom.insertCss(a,i,!0),t[i]="loaded"):t[i]=a,r()}catch(e){o(e)}})),e.reloadCss=((e,i,s,r,o)=>{const a=__Navimi_Helpers.isSameFile;if(a(o,e))return console.log(`${e} updated.`),t[o]=i,void __Navimi_Dom.insertCss(i,"globalCss");for(const o in s){const{jsUrl:n,cssUrl:l}=s[o];if(a(l,e))return console.log(`${e} updated.`),t[l]=i,void(r===n&&__Navimi_Dom.insertCss(i,"routeCss"))}})}(__Navimi_CSSs||(__Navimi_CSSs={})),function(e){e.setTitle=(e=>{document.title=e}),e.setNavimiLinks=(e=>{document.querySelectorAll("[navimi-link]").forEach(t=>{t.removeAttribute("navimi-link"),t.setAttribute("navimi-linked",""),t.addEventListener("click",t=>{t.preventDefault(),e(t.target.pathname)})})}),e.insertCss=((e,t,i)=>{const s=t?document.querySelector(`[cssId='${t}']`):void 0;if(s&&s.remove(),!e)return;const r=document.createElement("style");r.innerHTML=e,t&&r.setAttribute("cssId",t);const o=document.getElementsByTagName("head")[0]||document.body;i?o.prepend(r):o.appendChild(r)}),e.insertJS=((e,t)=>{const i=document.querySelector(`[jsUrl='${t}']`);i&&i.remove();const s=document.createElement("script");s.type="text/javascript",s.innerHTML=e,s.setAttribute("jsUrl",t),(document.getElementsByTagName("head")[0]||document.body).appendChild(s)}),e.addLibrary=(async e=>{let t=Array.isArray(e)?e:[e];(t=t.filter(e=>!__Navimi_JSs.isJsLoaded(e))).length>0&&await Promise.all(t.map(e=>{if("css"!==e.split(".").pop().toLowerCase())return __Navimi_JSs.fetchJS(void 0,[e]);__Navimi_CSSs.fetchCss(void 0,e,!0)})).catch(e=>{throw new Error(e)})})}(__Navimi_Dom||(__Navimi_Dom={})),function(e){e.loadErrors={},e.fetchFile=((t,i)=>new Promise((s,r)=>{delete e.loadErrors[t],fetch(t,i).then(async i=>{if(!i||!i.ok){const i=`Could not load the file! - ${t}`;return e.loadErrors[t]=i,r(i)}s(await i.text())}).catch(i=>{e.loadErrors[t]=i.message,r(i)})}))}(__Navimi_Fetch||(__Navimi_Fetch={})),function(e){const t=e=>{const t={};return e.split("&").map(e=>{const i=e.split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]||"")}),t},i=e=>{if(!e)return[];const t=e.indexOf("?");return(e=t>=0?e.substr(0,t):e).split("/").filter(e=>e.length>0)},s=(e,s)=>{const r=e.indexOf("?"),o=r>0?e.substr(r+1,e.length):"",a=i(e),n=i(s);let l={};r>0&&(l={queryString:t(o)});for(let e=0;e<n.length;e++)if(":"===n[e].charAt(0)){const t=n[e].slice(1);if(a.length<=e)return null;l[t]=decodeURIComponent(a[e])}else if(!a[e]||n[e].toLowerCase()!==a[e].toLowerCase())return null;return l};e.isSameFile=((e,t)=>e&&t&&e.split("?").shift().toLowerCase()==t.split("?").shift().toLowerCase()),e.timeout=(e=>new Promise(t=>setTimeout(t,e))),e.debounce=((e,t)=>{let i;return function(){clearTimeout(i),i=setTimeout(()=>{i=null,e.apply(this,arguments)},t)}}),e.getUrl=(()=>{const e=document.location,t=e.toString().match(/^[^#]*(#.+)$/),i=t?t[1]:"";return[e.pathname,e.search,i].join("")}),e.removeHash=(e=>{const t=e.indexOf("#");return t>0?e.substr(0,t):e}),e.stringify=(e=>{const t=[],i=e=>{if("function"==typeof e)return String(e);if(e instanceof Error)return e.message;if(null===e||"object"!=typeof e)return e;if(-1!==t.indexOf(e))return`[Circular: ${t.indexOf(e)}]`;if(t.push(e),Array.isArray(e)){const s=e.map(i);return t.pop(),s}const s=Object.keys(e).reduce((t,s)=>(t[s]=i(((e,t)=>{if(Object.prototype.hasOwnProperty.call(e,t))try{return e[t]}catch(e){return}return e[t]})(e,s)),t),{});return t.pop(),s};return JSON.stringify(i(e))}),e.cloneObject=(t=>null===t||"object"!=typeof t?t:Object.keys(t).reduce((i,s)=>null!==t[s]&&"object"==typeof t[s]?(i[s]=e.cloneObject(t[s]),i):(i[s]=t[s],i),Array.isArray(t)?[]:{})),e.getRouteAndParams=((e,t)=>{const r=i(e),o=t["*"];let a,n;for(const o in t){if(i(o).length===r.length&&(n=s(e,o))){a=t[o];break}}return!a&&o&&(a=o),{routeItem:a,params:n}})}(__Navimi_Helpers||(__Navimi_Helpers={})),function(e){let t;e.openHotWs=((s,r)=>{try{if(!("WebSocket"in window))return void console.error("Websocket is not supported by your browser!");console.warn("Connecting HOT..."),t=null,(t=new WebSocket(`ws://localhost:${!0===s?8080:s}`)).addEventListener("message",e=>{try{const t=JSON.parse(e.data||"");if(t.message)return void console.warn(t.message);t.filePath&&r((e,s,r,o,a)=>{i(t,e,s,r,o,a)})}catch(e){console.error("Could not parse HOT message:",e)}}),t.onclose=(()=>{console.warn("HOT Connection Closed!"),setTimeout(e.openHotWs,5e3,s)})}catch(e){console.error(e)}});const i=(e,t,i,s,r,o)=>{try{const a=e.filePath.replace(/\\/g,"/"),n=a.split(".").pop(),l=e.data;switch(n){case"css":__Navimi_CSSs.reloadCss(a,l,r,s,t);break;case"html":case"htm":__Navimi_Templates.reloadTemplate(a,l,r,s,i,()=>{o()});break;case"js":__Navimi_JSs.reloadJs(a,l,r,s,()=>{o()});case"gif":case"jpg":case"jpeg":case"png":case"svg":o()}}catch(e){console.error("Could not digest HOT payload: ",e)}}}(__Navimi_Hot||(__Navimi_Hot={})),function(e){const t="_promise_",i={},s={},r={},o={},a={};let n,l,c;const _=(e,t,s)=>{let r=void 0!==s?`(function(){window.__navimiLoader._jsLoaderCallback("${e}", ${s}, (function(){return ${t}   \n            })())}())`:t;i[e]=!!s||t,__Navimi_Dom.insertJS(r,e)},m=async(i,_,m)=>{const d=n[t+i],h=n[t+i+"_reject"];if(setTimeout(()=>{delete n[t+i],delete n[t+i+"_reject"]},10),_)return s[i]=m,void(d&&d(Object.freeze(m)));try{__Navimi_State.unwatchState(i);const t=Object.freeze({addLibrary:__Navimi_Dom.addLibrary,setTitle:__Navimi_Dom.setTitle,navigateTo:l,getTemplate:__Navimi_Templates.getTemplate,fetchJS:t=>{const s=Array.isArray(t)?t:[t];return s.map(e=>{o[e]=Object.assign(Object.assign({},o[e]||{}),{[i]:!0})}),e.fetchJS(void 0,s,!0)},fetchTemplate:e=>{const t=Array.isArray(e)?e:[e];return __Navimi_Templates.fetchTemplate(void 0,t,i)},setState:__Navimi_State.setState,getState:__Navimi_State.getState,setNavimiLinks:()=>__Navimi_Dom.setNavimiLinks(l),unwatchState:e=>__Navimi_State.unwatchState(i,e),watchState:(e,t)=>__Navimi_State.watchState(i,e,t)});let n;if(a[i].length>0){for(;-1!==a[i].map(e=>void 0===s[c.services[e]]).indexOf(!0);){if(a[i].map(e=>c.services[e]).find(e=>__Navimi_Fetch.loadErrors[e]))return;await __Navimi_Helpers.timeout(10)}a[i].map(e=>{n=Object.assign(Object.assign({},n),{[e]:s[c.services[e]]})})}let _=new m(t,n);r[i]=_,d&&d(_)}catch(e){h&&h(e)}};e.init=(e=>{l=e.navigateTo,c=e.options,n=window.__navimiLoader={_jsLoaderCallback:m}}),e.isJsLoaded=(e=>void 0!==i[e]),e.getInstance=(e=>r[e]),e.fetchJS=((e,o,a)=>{const l=o=>new Promise(async(l,c)=>a&&s[o]?l(s[o]):r[o]?l(r[o]):void(n[t+o]?await(e=>new Promise((i,s)=>{const o=setInterval(()=>r[e]?(clearInterval(o),i(r[e])):void 0===n[t+e]?(clearInterval(o),s(`Error loading file! ${e}`)):void 0,50)}))(o).then(l).catch(c):(n[t+o]=l,n[t+o+"_reject"]=c,((e,s,r)=>new Promise(async(o,a)=>{try{let l;l="string"==typeof i[s]?i[s]:await __Navimi_Fetch.fetchFile(s,{headers:{Accept:"application/javascript"},signal:e?e.signal:void 0}),_(s,l,r),void 0===r&&n[t+s](!0),o()}catch(e){a(e)}}))(e,o,a).catch(e=>{n[t+o+"_reject"](e)}))));return o.length>1?Promise.all(o.map(l)):l(o[0])}),e.loadServices=((t,i,s)=>{if(i&&s&&0!==s.length&&(a[i]=a[i]||[],s&&s.length>0)){let r=[];const n=s.map(e=>{const t=c.services&&c.services[e];return void 0===t?r.push(e):(-1===a[i].indexOf(e)&&a[i].push(e),o[t]=Object.assign(Object.assign({},o[t]||{}),{[i]:!0})),t});if(r.length>0)throw new Error("Service(s) not defined: "+r.join(", "));Promise.all(n.filter(e=>void 0!==e).map(i=>e.fetchJS(t,[i],!0)))}}),e.initJS=(async(t,i)=>{const s=e.getInstance(t);s&&s.init&&await s.init(i)}),e.reloadJs=((e,i,a,l,c)=>{const m=__Navimi_Helpers.isSameFile;for(const s in a){const{jsUrl:o}=a[s];if(m(o,e))return console.log(`${e} updated.`),delete r[o],n[t+o]=(()=>{o===l&&c()}),void _(o,i,!1)}for(const a in o)m(a,e)&&(console.log(`${e} updated.`),delete s[a],n[t+a]=(()=>{Object.keys(o[a]).map(e=>{delete r[e],e===l&&c()})}),_(e,i,!0))})}(__Navimi_JSs||(__Navimi_JSs={})),function(e){const t=[];e.addMiddlewares=(e=>{Array.isArray(e)&&t.push(...e.filter(e=>void 0!==e))}),e.executeMiddlewares=(async(e,i,s)=>{let r=-1;const o=async(a,n,l=0)=>{l===r&&console.warn("next() called multiple times"),r=l;const c=t[l];c?await c(i,async(t,i)=>{e.signal.aborted?n():t?(n(),s(t,i)):await o(a,n,l+1)}):a()};await new Promise(await o).catch(e=>{})})}(__Navimi_Middleware||(__Navimi_Middleware={}));class Navimi{constructor(e,t){this.navigateTo=((e,t)=>{this.initRoute(e,t)}),this.reportError=(e=>{this.options.onError?this.options.onError(e):console.error(e)}),this.initRoute=(async(e,t,i)=>{const s=__Navimi_Helpers.removeHash(e||__Navimi_Helpers.getUrl());if(!i){if(this.currentUrl===s)return;this.abortController.abort(),this.abortController=new AbortController}const r=++this.callId,o=void 0!==e;let{routeItem:a,params:n}=__Navimi_Helpers.getRouteAndParams(s,this.routesList);if(void 0!==t&&(n=Object.assign(Object.assign({},n),t)),this.options.onBeforeRoute){if(!1===await this.options.onBeforeRoute({url:s,routeItem:a,params:n},this.navigateTo))return}if(this.currentJS&&!i){const e=__Navimi_JSs.getInstance(this.currentJS);if(e){const t=e.beforeLeave;if(t){if(!1===t({url:s,routeItem:a,params:n}))return void(o||history.forward())}e.destroy&&e.destroy()}}if(a)if(await __Navimi_Middleware.executeMiddlewares(this.abortController,{url:s,routeItem:a,params:n},(e,t)=>{this.initRoute(e,t,!0)}),r<this.callId)console.warn("Navimi: A middleware has called navigateTo()");else{this.currentUrl=s;try{const{title:i,jsUrl:l,cssUrl:c,templatesUrl:_,dependsOn:m}=a||{};if(!l&&!_)throw new Error("The route must define the 'jsUrl' or 'templatesUrl'!");l&&(this.currentJS=l,this.routesParams[l]={url:s,routeItem:a,params:n}),o&&((null==t?void 0:t.replaceUrl)?history.replaceState(null,null,e):history.pushState(null,null,e)),__Navimi_CSSs.fetchCss(this.abortController,c).catch(e=>{}),__Navimi_Templates.fetchTemplate(this.abortController,[_]).catch(e=>{});try{__Navimi_JSs.loadServices(this.abortController,l,m)}catch(e){this.reportError(e)}for(l&&await __Navimi_JSs.fetchJS(this.abortController,[l],!1);c&&!__Navimi_CSSs.isCssLoaded(c)||_&&!__Navimi_Templates.isTemplateLoaded(_)||this.options.globalCssUrl&&!__Navimi_CSSs.isCssLoaded(this.options.globalCssUrl)||this.options.globalTemplatesUrl&&!__Navimi_Templates.isTemplateLoaded(this.options.globalTemplatesUrl);){if(await __Navimi_Helpers.timeout(10),r<this.callId)return;if(c&&__Navimi_Fetch.loadErrors[c]||_&&__Navimi_Fetch.loadErrors[_]||this.options.globalCssUrl&&__Navimi_Fetch.loadErrors[this.options.globalCssUrl]||this.options.globalTemplatesUrl&&__Navimi_Fetch.loadErrors[this.options.globalTemplatesUrl])return void this.reportError(new Error(__Navimi_Fetch.loadErrors[c]||__Navimi_Fetch.loadErrors[_]||__Navimi_Fetch.loadErrors[this.options.globalCssUrl]||__Navimi_Fetch.loadErrors[this.options.globalTemplatesUrl]))}__Navimi_Dom.setTitle(i);try{if(!l){const e=__Navimi_Templates.getTemplate(_),t=document.querySelector("body");return void(e&&t&&(t.innerHTML=e))}await __Navimi_JSs.initJS(l,this.routesParams[l])}catch(e){this.reportError(e)}finally{if(r<this.callId)return;__Navimi_Dom.setNavimiLinks(this.navigateTo),__Navimi_Dom.insertCss(__Navimi_CSSs.getCss(c),"routeCss"),this.options.onAfterRoute&&this.options.onAfterRoute({url:s,routeItem:a,params:n},this.navigateTo)}}catch(e){this.reportError(e)}}else r===this.callId&&this.reportError(new Error("No route match for url: "+s))}),this.callId=0,this.abortController=new AbortController,this.currentJS=void 0,this.currentUrl=void 0,this.routesParams={},this.routesList=e||{},this.options=t||{},this.win=window||{},this.win.addEventListener("popstate",()=>{this.initRoute()}),this.win.navigateTo=this.navigateTo,__Navimi_JSs.init({navigateTo:this.navigateTo.bind(this),options:this.options}),__Navimi_Middleware.addMiddlewares(this.options.middlewares),(async()=>{(this.options.globalCssUrl||this.options.globalTemplatesUrl)&&(await Promise.all([__Navimi_CSSs.fetchCss(void 0,this.options.globalCssUrl),__Navimi_Templates.fetchTemplate(void 0,[this.options.globalTemplatesUrl])]).catch(this.reportError),__Navimi_Dom.insertCss(__Navimi_CSSs.getCss(this.options.globalCssUrl),"globalCss"))})(),this.initRoute(),this.options.hot&&setTimeout(__Navimi_Hot.openHotWs,1e3,this.options.hot,e=>{e(this.options.globalCssUrl,this.options.globalTemplatesUrl,this.currentJS,this.routesList,()=>{this.initRoute(void 0,this.routesParams[this.currentJS],!0)})})}}!function(e){const t={},i={};let s={},r={};const o=__Navimi_Helpers.debounce(()=>{const t=Object.keys(i),s=Object.keys(r);r={},t.filter(e=>s.includes(e)).sort((e,t)=>t.length-e.length).map(t=>{Object.keys(i[t]).map(s=>{const r=e.getState(t);i[t][s]&&i[t][s].map(e=>e&&e(r))})})},10),a=(e,t)=>{t instanceof Error&&(t=Object.assign(Object.assign({},t),{message:t.message,stack:t.stack}));const i=e=>e&&"object"==typeof e&&!Array.isArray(e)&&null!==e;if(i(e)&&i(t))for(const s in t)i(t[s])?(!e[s]&&Object.assign(e,{[s]:{}}),a(e[s],t[s])):Object.assign(e,{[s]:t[s]})};e.setState=(n=>{const l=Object.keys(i);l.length>0&&(s=__Navimi_Helpers.cloneObject(t)),a(t,n),l.length>0&&((i=>{i.sort((e,t)=>t.length-e.length).map(o=>{r[o]||__Navimi_Helpers.stringify(e.getState(o,s)||"")!==__Navimi_Helpers.stringify(e.getState(o,t)||"")&&(r[o]=!0,i.map(e=>{o!==e&&0===o.indexOf(e)&&(r[e]=!0)}))})})(l),o())}),e.getState=((e,i)=>{const s=e?e.split(".").reduce((e,t)=>e&&e[t]||void 0,i||t):i||t;return s?Object.freeze(__Navimi_Helpers.cloneObject(s)):void 0}),e.watchState=((e,t,s)=>{t&&s&&(i[t]||(i[t]={}),i[t]=Object.assign(Object.assign({},i[t]),{[e]:[...i[t][e]||[],s]}))}),e.unwatchState=((e,t)=>{const s=t=>{i[t][e]=void 0,delete i[t][e],0===Object.keys(i[t]).length&&delete i[t]};if(t){(Array.isArray(t)?t:[t]).map(e=>{!i[e]&&(i[e]={}),s(e)})}else Object.keys(i).map(s)})}(__Navimi_State||(__Navimi_State={})),function(e){let t={},i={},s={};const r=(e,i)=>{const s=new RegExp("<t ([^>]+)>"),r=new RegExp("</t>"),o=new RegExp('id="([^"]+)"');let a=e;if(s.exec(a))for(;e&&e.length>0;){const e=s.exec(a);if(!e||0===e.length)break;const i=o.exec(e[1]),n=i.length>0&&i[1];a=a.substr(e.index+e[0].length);const l=r.exec(a);if(!n||!l||0===l.length)break;t[n]=a.substr(0,l.index)}else t[i]=a};e.isTemplateLoaded=(e=>void 0!==i[e]),e.getTemplate=(e=>{const i=(Array.isArray(e)?e:[e]).map(e=>t[e]);return i.length>1?i:i[0]}),e.fetchTemplate=((e,t,o)=>{const a=t=>new Promise(async(s,o)=>{if(!t||i[t])return s();try{const a=await __Navimi_Fetch.fetchFile(t,{headers:{Accept:"text/html"},signal:e?e.signal:void 0});r(a,t),i[t]=!0,s()}catch(e){o(e)}});return o&&t.map(e=>{s[e]=Object.assign(Object.assign({},s[e]||{}),{[o]:!0})}),t.length>1?Promise.all(t.map(a)):a(t[0])}),e.reloadTemplate=((e,t,i,o,a,n)=>{const l=__Navimi_Helpers.isSameFile;if(l(a,e))return console.log(`${e} updated.`),r(t,a),void n();for(const s in i){const{jsUrl:a,templatesUrl:c}=i[s];if(l(c,e))return console.log(`${e} updated.`),r(t,c),void(o===a&&n())}for(const i in s)l(i,e)&&(console.log(`${e} updated.`),r(t,i),Object.keys(s[i]).map(e=>{e===o&&n()}))})}(__Navimi_Templates||(__Navimi_Templates={}));