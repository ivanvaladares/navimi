/**
 * Navimi v0.2.2 
 * Developed by Ivan Valadares 
 * ivanvaladares@hotmail.com 
 * https://github.com/ivanvaladares/navimi 
 */ 
class __Navimi_Components{constructor(){this._components={},this.registerComponent=(t,e)=>{!this._components[t]&&/\-/.test(t)&&(Object.setPrototypeOf(e.prototype,HTMLElement.prototype),this._components[t]=this._createComponentClass(e,this._removeChildComponents,this._registerChildComponents))},this._disconnectComponent=e=>{e.props&&e.props.parentComponent&&(e.props.parentComponent.props.childComponents=e.props.parentComponent.props.childComponents.filter(t=>t!=e)),e._observer&&(e._observer.disconnect(),e._observer=null),e._attrObserver&&(e._attrObserver.disconnect(),e._attrObserver=null)},this._removeChildComponents=t=>{t.props&&t.props.childComponents&&t.props.childComponents.map(t=>{this._removeChildComponents(t),this._disconnectComponent(t),t.remove(),t.onAfterRemove&&t.onAfterRemove()})},this._readAttributes=t=>{var e,i=t.props.attributes;t.props.attributes=void 0;for(e of[].slice.call(t.attributes)){var s=e.name;"function"!=typeof t[s]&&(t.props.attributes=Object.assign(Object.assign({},t.props.attributes||{}),{[s]:e.value}))}return i},this._registerTag=e=>{var t=this._components[e.localName];Object.setPrototypeOf(e,t.prototype),e.props={},this._readAttributes(e);const i=e.parentElement;e._observer=new MutationObserver(t=>{!t.find(t=>0<t.removedNodes.length)||i.contains(e)||(this._removeChildComponents(e),this._disconnectComponent(e),e.onAfterRemove&&e.onAfterRemove())}),e._observer.observe(i,{childList:!0}),e._attrObserver=new MutationObserver(t=>{t.forEach(t=>{"attributes"===t.type&&(t=this._readAttributes(e),e.shouldUpdate&&!e.shouldUpdate(t,e.props.attributes)||e.update())})}),e._attrObserver.observe(e,{attributes:!0}),this._findParentComponent(e),e.init()},this._findParentComponent=t=>{let e=t.parentNode;for(;e;){if(/\-/.test(e.localName)&&this._components[e.localName])return void((t.props.parentComponent=e).props.childComponents=[...e.props.childComponents||[],t]);e=e.parentNode}},this._registerChildEvents=(t,e)=>{if(e.attributes)for(var i of[].slice.call(e.attributes)){i=i.name;"function"==typeof e[i]&&(e[i]=e[i].bind(t))}},this._registerChildComponents=i=>{const s=t=>{let e;for(e of t.childNodes)this._components[e.localName]?this._registerTag(e):(this._registerChildEvents(i,e),s(e))};s(i)},this._createComponentClass=(t,e,i)=>class extends t{init(){super.init&&super.init(),this.render()}update(){this.render()}render(){e(this),void 0===this.props.children&&(this.props.children=this.innerHTML),this.innerHTML=super.render&&super.render(),i(this),super.onAfterRender&&super.onAfterRender()}}}init(){this._components={},new MutationObserver(t=>{for(var e of t){let t;for(t of e.addedNodes)this._components[t.localName]&&!t.props&&this._registerTag(t)}}).observe(document.documentElement,{childList:!0,subtree:!0})}}class __Navimi_Core{constructor(t,e,i){this._navigateTo=(t,e)=>{this._initRoute(t,e)},this._reportError=t=>{this._options.onError?this._options.onError(t):console.error(t)},this._initRoute=async(t,e,i)=>{var s=this._navimiHelpers.removeHash(t||this._navimiHelpers.getUrl());if(!i){if(this._currentUrl===s)return;this._abortController&&this._abortController.abort(),this._abortController=window.AbortController?new AbortController:void 0}var r=++this._callId,a=void 0!==t;let{routeItem:n,params:o}=this._navimiHelpers.getRouteAndParams(s,this._routesList);if((void 0!==e&&(o=Object.assign(Object.assign({},o),e)),this._options.onBeforeRoute)&&!1===await this._options.onBeforeRoute({url:s,routeItem:n,params:o},this._navigateTo))return;if(this._currentJS&&!i){const d=this._navimiJSs.getInstance(this._currentJS);if(d){const v=d.beforeLeave;if(v)if(!1===v({url:s,routeItem:n,params:o}))return void(a||history.forward());d.destroy&&d.destroy()}}if(n){if(await this._navimiMiddlewares.executeMiddlewares(this._abortController,{url:s,routeItem:n,params:o},(t,e)=>{this._initRoute(t,e,!0)}).catch(this._reportError),!(r<this._callId)){this._currentUrl=s;try{var{title:h,jsUrl:l,cssUrl:c,templatesUrl:m,dependsOn:_}=n||{};if(!l&&!m)throw new Error("The route must define the 'jsUrl' or 'templatesUrl'!");l&&(this._currentJS=l,this._routesParams[l]={url:s,routeItem:n,params:o}),a&&(null!=e&&e.replaceUrl?history.replaceState(null,null,t):history.pushState(null,null,t)),this._navimiCSSs.fetchCss(this._abortController,c).catch(t=>{}),this._navimiTemplates.fetchTemplate(this._abortController,m).catch(t=>{});try{this._navimiJSs.loadServices(this._abortController,l,_)}catch(t){this._reportError(t)}for(l&&await this._navimiJSs.fetchJS(this._abortController,[l],"route");c&&!this._navimiCSSs.isCssLoaded(c)||m&&!this._navimiTemplates.isTemplateLoaded(m)||this._options.globalCssUrl&&!this._navimiCSSs.isCssLoaded(this._options.globalCssUrl)||this._options.globalTemplatesUrl&&!this._navimiTemplates.isTemplateLoaded(this._options.globalTemplatesUrl);){if(await this._navimiHelpers.timeout(10),r<this._callId)return;if(c&&this._navimiFetch.getErrors(c)||m&&this._navimiFetch.getErrors(m)||this._options.globalCssUrl&&this._navimiFetch.getErrors(this._options.globalCssUrl)||this._options.globalTemplatesUrl&&this._navimiFetch.getErrors(this._options.globalTemplatesUrl))return void this._reportError(new Error(this._navimiFetch.getErrors(c)||this._navimiFetch.getErrors(m)||this._navimiFetch.getErrors(this._options.globalCssUrl)||this._navimiFetch.getErrors(this._options.globalTemplatesUrl)))}this._navimiDom.setTitle(h);try{if(!l){var p=this._navimiTemplates.getTemplate(m);const u=document.querySelector("body");return void(p&&u&&(u.innerHTML=p))}await this._navimiJSs.initJS(l,this._routesParams[l])}catch(t){this._reportError(t)}finally{if(r<this._callId)return;this._navimiDom.setNavimiLinks(),this._navimiDom.insertCss(this._navimiCSSs.getCss(c),"routeCss"),this._options.onAfterRoute&&this._options.onAfterRoute({url:s,routeItem:n,params:o},this._navigateTo)}}catch(t){this._reportError(t)}}}else r===this._callId&&this._reportError(new Error("No route match for url: "+s))},this._callId=0,this._abortController=window.AbortController?new AbortController:void 0,this._currentJS,this._currentUrl,this._routesParams={},this._routesList=t||{},this._options=i||{},this._win=window||{},this._navimiFetch=e.navimiFetch,this._navimiDom=e.navimiDom,this._navimiCSSs=e.navimiCSSs,this._navimiJSs=e.navimiJSs,this._navimiTemplates=e.navimiTemplates,this._navimiMiddlewares=e.navimiMiddlewares,this._navimiHot=e.navimiHot,this._navimiHelpers=e.navimiHelpers,this._win.addEventListener("popstate",()=>{this._initRoute()}),this._win.navigateTo=this._navigateTo,this._navimiMiddlewares.addMiddlewares(this._options.middlewares),(async()=>{await this._init()})(),this._initRoute(),this._options.hot&&this._initHot()}async _init(){(this._options.globalCssUrl||this._options.globalTemplatesUrl)&&(await Promise.all([this._navimiCSSs.fetchCss(void 0,this._options.globalCssUrl),this._navimiTemplates.fetchTemplate(void 0,this._options.globalTemplatesUrl)]).catch(this._reportError),this._navimiDom.insertCss(this._navimiCSSs.getCss(this._options.globalCssUrl),"globalCss"))}_initHot(){console.warn("HOT is disabled! Use the unminified version to enable it.")}}class __Navimi_CSSs{constructor(){this._loadedCsss={},this.isCssLoaded=t=>void 0!==this._loadedCsss[t],this.getCss=t=>this._loadedCsss[t],this.fetchCss=(s,r,a)=>new Promise(async(t,e)=>{if(!r||this._loadedCsss[r])return t();try{var i=await this._navimiFetch.fetchFile(r,{headers:{Accept:"text/css"},signal:s?s.signal:void 0});a?(this._navimiDom.insertCss(i,r,!0),this._loadedCsss[r]="loaded"):this._loadedCsss[r]=i,t()}catch(t){e(t)}}),this.reloadCss=(t,e,i,s,r)=>{}}init(t,e,i){this._navimiDom=t,this._navimiFetch=e,this._navimiHelpers=i}}const __NAVIMI_DEV=!0,__NAVIMI_PROD=!1;class __Navimi_Dom{constructor(){this.setTitle=t=>{document.title=t},this.setNavimiLinks=()=>{document.querySelectorAll("[navimi-link]").forEach(t=>{t.removeAttribute("navimi-link"),t.setAttribute("navimi-linked",""),t.addEventListener("click",t=>{t.preventDefault(),window.navigateTo(t.target.pathname)})})},this.insertCss=(t,e,i)=>{const s=e?document.querySelector(`[cssId='${e}']`):void 0;if(s&&s.remove(),t){const r=document.createElement("style");r.innerHTML=t,e&&r.setAttribute("cssId",e);const a=document.getElementsByTagName("head")[0]||document.body;i?a.prepend(r):a.appendChild(r)}},this.insertJS=(t,e,i)=>{const s=document.querySelector(`[jsUrl='${e}']`),r=(s&&s.remove(),document.createElement("script")),a=(r.type=i?"module":"text/javascript",r.innerHTML=t,r.setAttribute("jsUrl",e),document.getElementsByTagName("head")[0]);(a||document.body).appendChild(r)},this.addLibrary=async t=>{const e=Array.isArray(t)?t:[t];let i=e.map(t=>{if("string"!=typeof t)return t;{const e=t.split(".").pop();return{url:t,type:"css"===e.toLowerCase()?"css":"jsLibrary"}}}).filter(t=>!this._navimiJSs.isJsLoaded(t.url));0<i.length&&await Promise.all(i.map(t=>{var e;if("css"!==t.type.toLowerCase())return e=0<=t.type.toLowerCase().indexOf("module")?"module":"library",this._navimiJSs.fetchJS(void 0,[t.url],e);this._navimiCSSs.fetchCss(void 0,t.url,!0)})).catch(t=>{throw new Error(t)})}}init(t,e){this._navimiCSSs=t,this._navimiJSs=e}}class __Navimi_Fetch{constructor(){this.loadErrors={},this.init=(t,e)=>{this._bustCache=t.bustCache,this._fetch=e},this.getErrors=t=>this.loadErrors[t],this.fetchFile=(r,e)=>new Promise((i,s)=>{delete this.loadErrors[r];var t=r+(this._bustCache?"?v="+this._bustCache:"");(this._fetch||fetch)(t,e).then(async t=>{var e;if(!t||!t.ok)return this.loadErrors[r]=e="Could not load the file! - "+r,s(e);i(await t.text())}).catch(t=>{this.loadErrors[r]=t.message,s(t)})})}}class __Navimi_Helpers{constructor(){this.parseQuery=t=>{const e={};return t.split("&").map(t=>{t=t.split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1]||"")}),e},this.splitPath=t=>{if(!t)return[];var e=t.indexOf("?");return(t=0<=e?t.substr(0,e):t).split("/").filter(t=>0<t.length)},this.parsePath=(t,e)=>{var i=t.indexOf("?"),s=0<i?t.substr(i+1,t.length):"";const r=this.splitPath(t),a=this.splitPath(e);let n={};0<i&&(n={queryString:this.parseQuery(s)});for(let t=0;t<a.length;t++)if(":"===a[t].charAt(0)){var o=a[t].slice(1);if(r.length<=t)return null;n[o]=decodeURIComponent(r[t])}else if(!r[t]||a[t].toLowerCase()!==r[t].toLowerCase())return null;return n},this.isSameFile=(t,e)=>t&&e&&t.split("?").shift().toLowerCase()==e.split("?").shift().toLowerCase(),this.timeout=e=>new Promise(t=>setTimeout(t,e)),this.debounce=(t,e)=>{let i;return function(){clearTimeout(i),i=setTimeout(()=>{i=null,t.apply(this,arguments)},e)}},this.getUrl=()=>{const t=document.location;var e=t.toString().match(/^[^#]*(#.+)$/);const i=e?e[1]:"";return[t.pathname,t.search,i].join("")},this.removeHash=t=>{var e=t.indexOf("#");return 0<e?t.substr(0,e):t},this.stringify=t=>{const e=[],s=i=>{if("function"==typeof i)return String(i);if(i instanceof Error)return i.message;if(null===i||"object"!=typeof i)return i;if(-1!==e.indexOf(i))return`[Circular: ${e.indexOf(i)}]`;if(e.push(i),Array.isArray(i))return t=i.map(s),e.pop(),t;var t=Object.keys(i).reduce((t,e)=>(t[e]=s(((t,e)=>{if(Object.prototype.hasOwnProperty.call(t,e))try{return t[e]}catch(t){return}return t[e]})(i,e)),t),{});return e.pop(),t};return JSON.stringify(s(t))},this.cloneObject=i=>null===i||"object"!=typeof i?i:Object.keys(i).reduce((t,e)=>(null!==i[e]&&"object"==typeof i[e]?t[e]=this.cloneObject(i[e]):t[e]=i[e],t),Array.isArray(i)?[]:{}),this.getRouteAndParams=(t,e)=>{var i=this.splitPath(t),s=e["*"];let r,a;for(const o in e){var n=this.splitPath(o);if(n.length===i.length&&(a=this.parsePath(t,o))){r=e[o];break}}return!r&&s&&(a=this.parsePath(t,t),r=s),{routeItem:r,params:a}}}}class __Navimi_Hot{constructor(){this.openHotWs=(t,e)=>{},this._digestHot=(t,e,i,s,r,a)=>{}}init(t,e,i){this._navimiCSSs=t,this._navimiJSs=e,this._navimiTemplates=i}}class __Navimi_JSs{constructor(){this._navimiLoaderNS="__navimiLoader",this._callBackNS="_jsLoaderCallback",this._promiseNS="_promise_",this._loadedJSs={},this._routesJSs={},this._othersJSs={},this._dependencyJSsMap={},this._routesJSsServices={},this._awaitJS=s=>new Promise((t,e)=>{const i=setInterval(()=>this._routesJSs[s]?(clearInterval(i),t(this._routesJSs[s])):void 0===this._navimiLoader[this._promiseNS+s]?(clearInterval(i),e("Error loading file! "+s)):void 0,50)}),this._fetch=(s,r,a)=>new Promise(async(e,i)=>{try{let t;t=this._loadedJSs[r]||await this._navimiFetch.fetchFile(r,{headers:{Accept:"application/javascript"},signal:s?s.signal:void 0}),this._insertJS(r,t,a),"route"!==a&&"service"!==a&&this._navimiLoader[this._promiseNS+r](!0),e()}catch(t){i(t)}}),this._insertJS=(t,e,i)=>{var s="module"===i||"library"===i?e:`(function(){window.${this._navimiLoaderNS}.${this._callBackNS}("${t}", "${i}", (function(){return ${e}   
                })())}())`;this._loadedJSs[t]=e,this._navimiDom.insertJS(s,t,"module"===i)},this._instantiateJS=async(i,t,s)=>{const r=this._navimiLoader[this._promiseNS+i],e=this._navimiLoader[this._promiseNS+i+"_reject"];if(setTimeout(()=>{delete this._navimiLoader[this._promiseNS+i],delete this._navimiLoader[this._promiseNS+i+"_reject"]},10),"route"!==t)return this._othersJSs[i]=s,void(r&&r(Object.freeze(s)));try{this._navimiState.unwatchState(i);var a={addLibrary:this._navimiDom.addLibrary,setTitle:this._navimiDom.setTitle,navigateTo:window.navigateTo,getTemplate:this._navimiTemplates.getTemplate,fetchJS:t=>{const e=Array.isArray(t)?t:[t];return e.map(t=>{this._dependencyJSsMap[t]=Object.assign(Object.assign({},this._dependencyJSsMap[t]||{}),{[i]:!0})}),this.fetchJS(void 0,e,"javascript")},fetchTemplate:t=>this._navimiTemplates.fetchTemplate(void 0,t,i),setState:this._navimiState.setState,getState:this._navimiState.getState,setNavimiLinks:this._navimiDom.setNavimiLinks,unwatchState:t=>this._navimiState.unwatchState(i,t),watchState:(t,e)=>this._navimiState.watchState(i,t,e)};let e={};if(this._routesJSsServices[i]&&0<this._routesJSsServices[i].length){for(;;){if(-1===this._routesJSsServices[i].map(t=>void 0===this._othersJSs[this._options.services[t]]).indexOf(!0))break;if(this._routesJSsServices[i].map(t=>this._options.services[t]).find(t=>this._navimiFetch.getErrors(t)))return;await this._navimiHelpers.timeout(10)}this._routesJSsServices[i].map(t=>{e=Object.assign(Object.assign({},e),{[t]:this._othersJSs[this._options.services[t]]})})}var n=new s(Object.freeze(a),e);this._routesJSs[i]=n,r&&r(n)}catch(t){e&&e(t)}},this.isJsLoaded=t=>void 0!==this._loadedJSs[t],this.getInstance=t=>this._routesJSs[t],this.fetchJS=(s,t,r)=>{var e=i=>new Promise(async(t,e)=>"route"!==r&&this._othersJSs[i]?t(this._othersJSs[i]):this._routesJSs[i]?t(this._routesJSs[i]):void(this._navimiLoader[this._promiseNS+i]?await this._awaitJS(i).then(t).catch(e):(this._navimiLoader[this._promiseNS+i]=t,this._navimiLoader[this._promiseNS+i+"_reject"]=e,this._fetch(s,i,r).catch(t=>{this._navimiLoader[this._promiseNS+i+"_reject"](t)}))));return 1<t.length?Promise.all(t.map(e)):e(t[0])},this.loadServices=(e,s,t)=>{if(s&&t&&0!==t.length&&(this._routesJSsServices[s]=this._routesJSsServices[s]||[],t&&0<t.length)){let i=[];const r=t.map(t=>{var e=this._options.services&&this._options.services[t];return void 0===e?i.push(t):(-1===this._routesJSsServices[s].indexOf(t)&&this._routesJSsServices[s].push(t),this._dependencyJSsMap[e]=Object.assign(Object.assign({},this._dependencyJSsMap[e]||{}),{[s]:!0})),e});if(0<i.length)throw new Error("Service(s) not defined: "+i.join(", "));Promise.all(r.filter(t=>void 0!==t).map(t=>this.fetchJS(e,[t],"service")))}},this.initJS=async(t,e)=>{const i=this.getInstance(t);i&&i.init&&await i.init(e)},this.reloadJs=(t,e,i,s,r)=>{}}init(t,e,i,s,r,a){this._navimiDom=t,this._navimiFetch=e,this._navimiTemplates=i,this._navimiState=s,this._navimiHelpers=r,this._options=a,this._navimiLoader=window[this._navimiLoaderNS]={[this._callBackNS]:this._instantiateJS}}}class __Navimi_Middlewares{constructor(){this._middlewareStack=[],this.addMiddlewares=t=>{Array.isArray(t)&&this._middlewareStack.push(...t.filter(t=>void 0!==t))},this.executeMiddlewares=async(a,e,n)=>{let o=-1;const h=async(i,s,r=0)=>{o=r;const t=this._middlewareStack[r];if(t)try{await t(e,async(t,e)=>{a&&a.signal.aborted?i():t?(n(t,e),i()):await h(i,s,r+1)})}catch(t){s(t)}else i()};return new Promise(h)}}}class Navimi{constructor(t,e,i,s){const r=null!=(l=null==i?void 0:i.navimiFetch)?l:new __Navimi_Fetch,a=null!=(l=null==i?void 0:i.navimiDom)?l:new __Navimi_Dom,n=null!=(l=null==i?void 0:i.navimiCSSs)?l:new __Navimi_CSSs,o=null!=(l=null==i?void 0:i.navimiJSs)?l:new __Navimi_JSs,h=null!=(l=null==i?void 0:i.navimiTemplates)?l:new __Navimi_Templates;var l=null!=(l=null==i?void 0:i.navimiMiddlewares)?l:new __Navimi_Middlewares;const c=null!=(_=null==i?void 0:i.navimiState)?_:new __Navimi_State,m=null!=(_=null==i?void 0:i.navimiHot)?_:new __Navimi_Hot;var i=null!=(_=null==i?void 0:i.navimiHelpers)?_:new __Navimi_Helpers,_=(r.init(e),n.init(a,r,i),a.init(n,o),o.init(a,r,h,c,i,e),h.init(r,i),c.init(i),0,{navimiFetch:r,navimiJSs:o,navimiCSSs:n,navimiDom:a,navimiTemplates:h,navimiMiddlewares:l,navimiState:c,navimiHot:m,navimiHelpers:i});return s?s(t,_,e):new __Navimi_Core(t,_,e)}}class __Navimi_State{constructor(){this.state={},this.stateWatchers={},this.prevState={},this.stateDiff={},this._navimiHelpers={},this.getStateDiff=t=>{t.sort((t,e)=>e.length-t.length).map(e=>{this.stateDiff[e]||this._navimiHelpers.stringify(this.getState(e,this.prevState)||"")!==this._navimiHelpers.stringify(this.getState(e,this.state)||"")&&(this.stateDiff[e]=!0,t.map(t=>{e!==t&&0===e.indexOf(t)&&(this.stateDiff[t]=!0)}))})},this.mergeState=(t,e)=>{e instanceof Error&&(e=Object.assign(Object.assign({},e),{message:e.message,stack:e.stack}));var i=t=>t&&"object"==typeof t&&!Array.isArray(t)&&null!==t;if(i(t)&&i(e))for(const s in e)i(e[s])?(t[s]||Object.assign(t,{[s]:{}}),this.mergeState(t[s],e[s])):Object.assign(t,{[s]:e[s]})},this.setState=t=>{var e=Object.keys(this.stateWatchers);0<e.length&&(this.prevState=this._navimiHelpers.cloneObject(this.state)),this.mergeState(this.state,t),0<e.length&&(this.getStateDiff(e),this.invokeStateWatchers())},this.getState=(t,e)=>{t=t?t.split(".").reduce((t,e)=>t&&t[e]||void 0,e||this.state):e||this.state;return t?Object.freeze(this._navimiHelpers.cloneObject(t)):void 0},this.watchState=(t,e,i)=>{e&&i&&(this.stateWatchers[e]||(this.stateWatchers[e]={}),this.stateWatchers[e]=Object.assign(Object.assign({},this.stateWatchers[e]),{[t]:[...this.stateWatchers[e][t]||[],i]}))},this.unwatchState=(e,t)=>{const i=t=>{this.stateWatchers[t][e]=void 0,delete this.stateWatchers[t][e],0===Object.keys(this.stateWatchers[t]).length&&delete this.stateWatchers[t]};if(t){const s=Array.isArray(t)?t:[t];void s.map(t=>{this.stateWatchers[t]||(this.stateWatchers[t]={}),i(t)})}else Object.keys(this.stateWatchers).map(i)}}init(t){this._navimiHelpers=t,this.invokeStateWatchers=t.debounce(()=>{const t=Object.keys(this.stateWatchers),e=Object.keys(this.stateDiff);this.stateDiff={},t.filter(t=>0<=e.indexOf(t)).sort((t,e)=>e.length-t.length).map(i=>{Object.keys(this.stateWatchers[i]).map(t=>{const e=this.getState(i);this.stateWatchers[i][t]&&this.stateWatchers[i][t].map(t=>t&&t(e))})})},10)}}class __Navimi_Templates{constructor(){this._templatesCache={},this._loadedTemplates={},this._dependencyTemplatesMap={},this.loadTemplate=(t,e)=>{const i=new RegExp("<t ([^>]+)>"),s=new RegExp("</t>"),r=new RegExp("id=(\"[^\"]+\"|'[^']+')");let a=t;if(i.exec(a))for(;t&&0<t.length;){var n=i.exec(a);if(!n||0===n.length)break;const h=r.exec(n[1]);var o=0<h.length&&h[1].slice(1,-1),n=(a=a.substr(n.index+n[0].length),s.exec(a));if(!o||!n||0===n.length)break;this._templatesCache[o]=a.substr(0,n.index)}else this._templatesCache[e]=a},this.isTemplateLoaded=t=>void 0!==this._loadedTemplates[t],this.getTemplate=t=>{const e=Array.isArray(t)?t:[t];t=e.map(t=>this._templatesCache[t]);return 1<t.length?t:t[0]},this.fetchTemplate=(r,t,e)=>{var i=s=>new Promise(async(t,e)=>{if(!s||this._loadedTemplates[s])return t();try{var i=await this._navimiFetch.fetchFile(s,{headers:{Accept:"text/html"},signal:r?r.signal:void 0});this.loadTemplate(i,s),this._loadedTemplates[s]=!0,t()}catch(t){e(t)}});const s=Array.isArray(t)?t:[t];return e&&s.map(t=>{this._dependencyTemplatesMap[t]=Object.assign(Object.assign({},this._dependencyTemplatesMap[t]||{}),{[e]:!0})}),1<s.length?Promise.all(s.map(i)):i(s[0])},this.reloadTemplate=(t,e,i,s,r,a)=>{}}init(t,e){this._navimiFetch=t,this._navimiHelpers=e}}