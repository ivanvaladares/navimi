/**
 * Navimi v0.2.2 
 * Developed by Ivan Valadares 
 * ivanvaladares@hotmail.com 
 * https://github.com/ivanvaladares/navimi 
 */ 
class __Navimi_Components{constructor(){this._components={},this._removeComponent=t=>{t.localName&&t.__rendered&&this._components[t.localName]&&(t.__rendered=!1,this._removeChildComponents(t),this._disconnectComponent(t),t.remove(),t.onUnmount&&t.onUnmount())},this._disconnectComponent=e=>{e.parentComponent&&(e.parentComponent.childComponents=e.parentComponent.childComponents.filter(t=>t!==e))},this._removeChildComponents=t=>{t.childComponents&&t.childComponents.map(t=>{this._removeComponent(t)})},this._readAttributes=t=>{var e=t.props;t.props={};for(const i of[].slice.call(t.attributes)){var s=i.name;"function"!=typeof t[s]&&(t.props=Object.assign(Object.assign({},t.props||{}),{[s]:i.value}))}return e},this._traverseTree=(e,s)=>{if(e.localName)if(this._components[e.localName])s(e);else{let t;for(t of e.children)this._traverseTree(t,s)}},this._registerTag=async(t,e)=>{if(!t.props){const s=this._components[t.localName];t.props={},t.__rendered=!1,t.__previousTemplate=void 0,t.__initalInnerHTML=t.innerHTML,t.innerHTML="",t.parentComponent=void 0,t.childComponents=[],this._findParentComponent(t,e),this._readAttributes(t),Object.setPrototypeOf(t,new s(t.props)),t.update=this._navimiHelpers.throttle(t.render,10,t),await t.init()}},this._findParentComponent=(e,t)=>{var s=t=>{(e.parentComponent=t).childComponents=[...t.childComponents||[],e]};if(t)s(t);else{let t=e.parentNode;for(;t;){if(/-/.test(t.localName)&&this._components[t.localName])return void s(t);t=t.parentNode}}},this._registerChildEvents=(t,e)=>{if(e.attributes)for(const i of[].slice.call(e.attributes)){var s=i.name;"function"==typeof e[s]&&(e[s]=e[s].bind(t))}},this._registerChildComponents=s=>{const i=t=>{let e;for(e of t.childNodes)this._components[e.localName]?this._registerTag(e,s):(this._registerChildEvents(s,e),i(e))};i(s)},this.mergeHtml=(t,s)=>{var i=t=>3===t.nodeType?"text":8===t.nodeType?"comment":t.tagName.toLowerCase(),r=t=>t.childNodes&&0<t.childNodes.length?null:t.textContent,n=[].slice.call(t.childNodes);let a=[].slice.call(s.childNodes),o=a.length-n.length;for(let e=0;e<n.length;e++){const c=n[e];if(a[e])if(i(c)!==i(a[e]))0<o?(this._traverseTree(a[e],this._removeComponent),a[e].parentNode&&a[e].parentNode.removeChild(a[e]),e--):s.insertBefore(c.cloneNode(!0),a[e]),a=[].slice.call(s.childNodes);else{var h=r(c);if(h&&h!==r(a[e])&&(a[e].textContent=h),c.localName){if(c.localName===a[e].localName){const m=[].slice.call(a[e].attributes),_=[].slice.call(c.attributes);var h=_.filter(e=>m.find(t=>e.name===t.name&&e.value!==t.value));const d=m.filter(e=>!_.find(t=>e.name===t.name));var l=_.filter(e=>!m.find(t=>e.name===t.name));d.map(t=>{a[e].removeAttribute(t.name)}),[...h,...l].map(t=>{a[e].setAttribute(t.name,t.value)})}this._components[c.localName]||(0<a[e].childNodes.length&&c.childNodes.length<1?a[e].innerHTML="":a[e].childNodes.length<1&&0<c.childNodes.length?(h=document.createDocumentFragment(),this.mergeHtml(c,h),a[e].appendChild(h)):0<c.childNodes.length&&this.mergeHtml(c,a[e]))}}else s.appendChild(c.cloneNode(!0))}for(o=a.length-n.length;0<o;){var e=a.length-o;this._traverseTree(a[e],this._removeComponent),a[e].parentNode&&a[e].parentNode.removeChild(a[e]),o--}},this._createComponentClass=(t,i,r)=>class extends t{constructor(t){super(t)}async init(){super.init&&await super.init(),await this.render(),super.onMount&&await super.onMount()}async render(){this.__rendered=!0;var t=super.render&&await super.render(this.__initalInnerHTML);if(t&&t!==this.__previousTemplate){this.__previousTemplate=t;const e=new DOMParser,s=e.parseFromString(t,"text/html");r(s.querySelector("body"),this),i(this)}super.onRender&&super.onRender()}},this.registerComponent=(t,e)=>{!this._components[t]&&/-/.test(t)&&(Object.setPrototypeOf(e.prototype,HTMLElement.prototype),this._components[t]=this._createComponentClass(e,this._registerChildComponents,this.mergeHtml))}}init(t){this._components={},this._navimiHelpers=t,new MutationObserver(t=>{for(const s of t)if("attributes"===s.type){const i=s.target;var e;this._components[i.localName]&&(e=this._readAttributes(i),i.shouldUpdate&&!i.shouldUpdate(e,i.props)||i.update())}else{for(const r of s.addedNodes)this._traverseTree(r,this._registerTag);for(const n of s.removedNodes)this._traverseTree(n,this._removeComponent)}}).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0})}}class __Navimi_Core{constructor(t,e,s){this._navigateTo=(t,e)=>{this._initRoute(t,e)},this._reportError=t=>{this._options.onError?this._options.onError(t):console.error(t)},this._waitForAssets=i=>{const r=this._options.globalCssUrl,n=this._options.globalTemplatesUrl;return r||n?new Promise(e=>{const s=setInterval(()=>{let t=!0;if((r&&!this._navimiCSSs.isCssLoaded(r)||n&&!this._navimiTemplates.isTemplateLoaded(n))&&(t=!1),this._navimiFetch.getErrors(r)||this._navimiFetch.getErrors(n)||t||i<this._callId)return clearInterval(s),e()},10)}):Promise.resolve()},this._initRoute=async(t,e,s)=>{try{var i=this._navimiHelpers.removeHash(t||this._navimiHelpers.getUrl());if(!s){if(this._currentUrl===i)return;this._abortController&&this._abortController.abort(),this._abortController=window.AbortController?new AbortController:void 0}var r=++this._callId,n=void 0!==t,{routeItem:a,params:o}=this._navimiHelpers.getRouteAndParams(i,this._routesList),h=Object.assign({url:i,routeItem:a,params:o},e||{});if(this._currentJS&&!s){if(this._options.onBeforeRoute)if(!1===await this._options.onBeforeRoute(h,this._navigateTo))return;const u=this._navimiJSs.getInstance(this._currentJS);if(u){const f=u.beforeLeave;if(f)if(!1===f(h))return void(n||history.forward());u.destroy&&u.destroy()}}if(!a)return void(r===this._callId&&this._reportError(new Error("No route match for url: "+i)));if(await this._navimiMiddlewares.executeMiddlewares(this._abortController,h,(t,e)=>{this._initRoute(t,e,!0)}).catch(this._reportError),r<this._callId)return;this._currentUrl=i;var{title:l,jsUrl:c,cssUrl:m,templatesUrl:_,services:d,components:p}=a||{};if(!c&&!_)throw new Error("The route must define the 'jsUrl' or 'templatesUrl'!");if(c&&(this._currentJS=c,this._routesParams[c]=h),n&&(e&&e.replaceUrl?history.replaceState(null,null,t):history.pushState(null,null,t)),await Promise.all([this._navimiJSs.loadDependencies(this._abortController,c||i,d,p),this._navimiCSSs.fetchCss(this._abortController,m),this._navimiTemplates.fetchTemplate(this._abortController,_),c&&this._navimiJSs.fetchJS(this._abortController,[c],"route")]).catch(this._reportError),await this._waitForAssets(r),this._navimiHelpers.setTitle(l),this._globalCssInserted||(this._globalCssInserted=!0,this._navimiCSSs.insertCss(this._options.globalCssUrl,"globalCss")),!c){var v=this._navimiTemplates.getTemplate(_);const g=document.querySelector("body");return void(v&&g&&(g.innerHTML=v))}await this._navimiJSs.initJS(c,this._routesParams[c]),r===this._callId&&(this._navimiHelpers.setNavimiLinks(),this._navimiCSSs.insertCss(m,"routeCss"),this._options.onAfterRoute&&this._options.onAfterRoute(h,this._navigateTo))}catch(t){this._reportError(t)}},this._callId=0,this._abortController=window.AbortController?new AbortController:void 0,this._currentJS,this._currentUrl,this._routesParams={},this._routesList=t||{},this._options=s||{},this._globalCssInserted=!1,this._win=window||{},this._navimiFetch=e.navimiFetch,this._navimiCSSs=e.navimiCSSs,this._navimiJSs=e.navimiJSs,this._navimiTemplates=e.navimiTemplates,this._navimiMiddlewares=e.navimiMiddlewares,this._navimiHot=e.navimiHot,this._navimiHelpers=e.navimiHelpers,this._win.addEventListener("popstate",()=>{this._initRoute()}),this._win.navigateTo=this._navigateTo,this._navimiMiddlewares.addMiddlewares(this._options.middlewares),(async()=>{await this._init()})(),this._initRoute(),this._options.hot&&this._initHot()}_init(){(this._options.globalCssUrl||this._options.globalTemplatesUrl)&&Promise.all([this._navimiCSSs.fetchCss(void 0,this._options.globalCssUrl),this._navimiTemplates.fetchTemplate(void 0,this._options.globalTemplatesUrl)]).catch(this._reportError)}_initHot(){}}class __Navimi_CSSs{constructor(){this._loadedCsss={},this._replaceCss=(t,e)=>{const s=document.querySelector(`[cssUrl='${e}']`);s&&(s.innerHTML=t)},this.isCssLoaded=t=>void 0!==this._loadedCsss[t],this.fetchCss=(t,e)=>!e||this._loadedCsss[e]?Promise.resolve():this._navimiFetch.fetchFile(e,{headers:{Accept:"text/css"},signal:t?t.signal:void 0}).then(t=>{this._loadedCsss[e]=t}),this.insertCss=(t,e,s)=>{if("routeCss"===e){const r=document.querySelector(`[cssType='${e}']`);if(r){if(r.getAttribute("cssUrl")===t)return;r.remove()}}if(!document.querySelector(`[cssUrl='${t}']`)){var i=this._loadedCsss[t];if(i){const n=document.createElement("style");n.innerHTML=i,t&&n.setAttribute("cssUrl",t),t&&n.setAttribute("cssType",e);const a=document.getElementsByTagName("head")[0]||document.body;s?a.prepend(n):a.appendChild(n)}}}}init(t){this._navimiFetch=t}}class __Navimi_Fetch{constructor(){this.loadErrors={},this.init=t=>{this._bustCache=t.bustCache},this.getErrors=t=>this.loadErrors[t],this.fetchFile=(r,n)=>new Promise((e,s)=>{delete this.loadErrors[r];var t=r+(this._bustCache?"?v="+this._bustCache:"");const i="Could not load the file! - "+r;fetch(t,n).then(t=>{if(!t||!t.ok)return this.loadErrors[r]=i,s(i);t.text().then(e)}).catch(()=>{this.loadErrors[r]=i,s(i)})})}}class __Navimi_Helpers{constructor(){this.parseQuery=t=>{const e={};return t.split("&").map(t=>{t=t.split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1]||"")}),e},this.splitPath=t=>{if(!t)return[];var e=t.indexOf("?");return(t=0<=e?t.substring(0,e):t).split("/").filter(t=>0<t.length)},this.parsePath=(t,e)=>{var s=t.indexOf("?"),i=0<s?t.substring(s+1,t.length):"";const r=this.splitPath(t),n=this.splitPath(e);let a={};0<s&&(a={queryString:this.parseQuery(i)});for(let t=0;t<n.length;t++)if(":"===n[t].charAt(0)){var o=n[t].slice(1);if(r.length<=t)return null;a[o]=decodeURIComponent(r[t])}else if(!r[t]||n[t].toLowerCase()!==r[t].toLowerCase())return null;return a},this.timeout=e=>new Promise(t=>setTimeout(t,e)),this.debounce=(e,s)=>{let i;return function(...t){clearTimeout(i),i=setTimeout(()=>{i=null,e.apply(this,t)},s)}},this.throttle=(s,i,r)=>{let n,a;return function(...t){const e=Date.now();a&&e<a+i?(clearTimeout(n),n=setTimeout(()=>{a=e,s.apply(r,t)},i)):(a=e,s.apply(r,t))}},this.getUrl=()=>{const t=document.location;var e=t.toString().match(/^[^#]*(#.+)$/);const s=e?e[1]:"";return[t.pathname,t.search,s].join("")},this.setTitle=t=>{document.title=t},this.setNavimiLinks=()=>{document.querySelectorAll("[navimi-link]").forEach(t=>{t.removeAttribute("navimi-link"),t.addEventListener("click",t=>{t.preventDefault(),window.navigateTo(t.target.pathname)})})},this.removeHash=t=>{var e=t.indexOf("#");return 0<e?t.substring(0,e):t},this.stringify=t=>{const e=[],i=s=>{if("function"==typeof s)return String(s);if(s instanceof Error)return s.message;if(null===s||"object"!=typeof s)return s;if(-1!==e.indexOf(s))return`[Circular: ${e.indexOf(s)}]`;if(e.push(s),Array.isArray(s))return t=s.map(i),e.pop(),t;var t=Object.keys(s).reduce((t,e)=>(t[e]=i(((t,e)=>{if(Object.prototype.hasOwnProperty.call(t,e))try{return t[e]}catch(t){return}return t[e]})(s,e)),t),{});return e.pop(),t};return JSON.stringify(i(t))},this.cloneObject=s=>null===s||"object"!=typeof s?s:Object.keys(s).reduce((t,e)=>(null!==s[e]&&"object"==typeof s[e]?t[e]=this.cloneObject(s[e]):t[e]=s[e],t),Array.isArray(s)?[]:{}),this.getRouteAndParams=(t,e)=>{var s=this.splitPath(t),i=e["*"];let r,n;for(const o in e){var a=this.splitPath(o);if(a.length===s.length&&(n=this.parsePath(t,o))){r=e[o];break}}return!r&&i&&(n=this.parsePath(t,t),r=i),{routeItem:r,params:n}}}}class __Navimi_Hot{constructor(){this.openHotWs=t=>{try{if(!("WebSocket"in window))return void console.error("Websocket is not supported by your browser!");console.warn("Connecting HOT...");var e=!0===t?8080:t;this._wsHotClient=null,this._wsHotClient=new WebSocket("ws://localhost:"+e),this._wsHotClient.addEventListener("message",t=>{try{var e=JSON.parse(t.data||"");if(e.message)return void console.warn(e.message);e.filePath&&this._digestHot(e)}catch(t){console.error("Could not parse HOT message:",t)}}),this._wsHotClient.onclose=()=>{console.warn("HOT Connection Closed!"),setTimeout(this.openHotWs,5e3,t)}}catch(t){console.error(t)}},this._digestHot=t=>{var e;try{const s=t.filePath.replace(/\\/g,"/");switch(null==(e=s.split(".").pop())?void 0:e.toLocaleLowerCase()){case"css":this._navimiCSSs.digestHot(t);break;case"html":case"htm":this._navimiTemplates.digestHot(t).then(()=>this._initRouteFunc());break;case"js":this._navimiJSs.digestHot(t).then(()=>this._initRouteFunc());break;case"gif":case"jpg":case"jpeg":case"png":case"svg":this._initRouteFunc()}}catch(t){console.error("Could not digest HOT payload: ",t)}}}init(t,e,s,i){this._navimiCSSs=t,this._navimiJSs=e,this._navimiTemplates=s,this._initRouteFunc=i}}class __Navimi_JSs{constructor(){this._navimiLoaderNS="__navimiLoader",this._callBackNS="_jsLoaderCallback",this._promiseNS="_promise_",this._loadedJSs={},this._jsType={},this._jsInstances={},this._dependencyJSsMap={},this._routesJSsServices={},this._routesJSsComponents={},this._resolvePromise=(t,e)=>{this._navimiLoader[this._promiseNS+e](t)},this._rejectPromise=(t,e)=>{this._navimiLoader[this._promiseNS+e+"_reject"](t)},this._awaitJS=r=>new Promise((e,s)=>{const i=setInterval(()=>{if(this._jsInstances[r])return clearInterval(i),e(this._jsInstances[r]);var t=this._jsType[r];if(("library"===t||"module"===t)&&this.isJsLoaded(r))return clearInterval(i),e("");t=this._navimiFetch.getErrors(r);return t?(clearInterval(i),s(t)):void 0},10)}),this._addLibrary=async t=>{const e=Array.isArray(t)?t:[t];if(0<e.length){const s=e.map(t=>{if("string"!=typeof t)return t;{const e=t.split(".").pop();return{url:t,type:e.toLowerCase()}}});await Promise.all(s.map(t=>{var e=t.type.toLowerCase();return"css"===e?this._navimiCSSs.fetchCss(void 0,t.url).then(()=>{this._navimiCSSs.insertCss(t.url,"library",!0)}):this.fetchJS(void 0,[t.url],"module"===e?"module":"library")})).catch(t=>{throw new Error(t)})}},this._fetch=(t,e,s)=>this._navimiFetch.fetchFile(e,{headers:{Accept:"application/javascript"},signal:t?t.signal:void 0}).then(t=>{this._jsType[e]=s,this._insertJS(e,t,s)}),this._insertJS=(t,e,s)=>{var i="module"===s||"library"===s?e:`(function(){window.${this._navimiLoaderNS}.${this._callBackNS}("${t}", "${s}", (function(){return ${e}   
                })())}())`;this._loadedJSs[t]=e;const r=document.querySelector(`[jsUrl='${t}']`),n=(r&&r.remove(),document.createElement("script")),a=(n.type="module"===s?"module":"text/javascript",n.innerHTML=i,n.setAttribute("jsUrl",t),document.getElementsByTagName("head")[0]);(a||document.body).appendChild(n),"module"!==s&&"library"!==s||this._resolvePromise(!0,t)},this._instantiateJS=async(s,t,i)=>{if("route"!==t)return this._jsInstances[s]=i,void this._resolvePromise(Object.freeze(i),s);try{this._navimiState.unwatchState(s);var r={addLibrary:this._addLibrary,setTitle:this._navimiHelpers.setTitle,navigateTo:window.navigateTo,getTemplate:this._navimiTemplates.getTemplate,fetchJS:t=>{const e=Array.isArray(t)?t:[t];return e.map(t=>{this._dependencyJSsMap[t]=Object.assign(Object.assign({},this._dependencyJSsMap[t]||{}),{[s]:!0})}),this.fetchJS(void 0,e,"javascript")},fetchTemplate:t=>this._navimiTemplates.fetchTemplate(void 0,t),setState:this._navimiState.setState,getState:this._navimiState.getState,setNavimiLinks:this._navimiHelpers.setNavimiLinks,unwatchState:t=>this._navimiState.unwatchState(s,t),watchState:(t,e)=>this._navimiState.watchState(s,t,e)};const a=[];for(const o in this._dependencyJSsMap)this._dependencyJSsMap[o][s]&&a.push(o);await Promise.all(a.map(this._awaitJS));let e={};this._routesJSsServices[s].map(t=>{e=Object.assign(Object.assign({},e),{[t]:this._jsInstances[this._options.services[t]]})});var n=new i(Object.freeze(r),e);this._jsInstances[s]=n,this._resolvePromise(n,s)}catch(t){this._rejectPromise(t,s)}},this._isJsLoading=t=>void 0!==this._navimiLoader[this._promiseNS+t]&&!this._navimiFetch.getErrors(t),this.isJsLoaded=t=>void 0!==this._loadedJSs[t],this.getInstance=t=>this._jsInstances[t],this.fetchJS=(i,t,r)=>{var e=s=>new Promise((t,e)=>this._jsInstances[s]?t(this._jsInstances[s]):!this._loadedJSs[s]||"module"!==r&&"library"!==r?this._isJsLoading(s)?this._awaitJS(s).then(t).catch(e):(this._navimiLoader[this._promiseNS+s]=t,this._navimiLoader[this._promiseNS+s+"_reject"]=e,void this._fetch(i,s,r).catch(e)):t(!0));return 1<t.length?Promise.all(t.map(e)):e(t[0])},this.loadDependencies=(e,r,t,s)=>{if(r){var i=(t,s)=>{const i=[];t=(t||[]).map(t=>{var e=this._options[s]&&this._options[s][t];return void 0===e?i.push(t):("services"===s&&-1===this._routesJSsServices[r].indexOf(t)&&this._routesJSsServices[r].push(t),"components"===s&&-1===this._routesJSsComponents[r].indexOf(t)&&this._routesJSsComponents[r].push(t),this._dependencyJSsMap[e]=Object.assign(Object.assign({},this._dependencyJSsMap[e]||{}),{[r]:!0})),e});if(0<i.length)throw new Error(s+" not defined: "+i.join(", "));return t};this._routesJSsServices[r]=this._routesJSsServices[r]||[],this._routesJSsComponents[r]=this._routesJSsComponents[r]||[];const n=i(t,"services"),a=i(s,"components");t=n.filter(t=>void 0!==t).map(t=>this.fetchJS(e,[t],"service")).concat(a.filter(t=>void 0!==t).map(s=>this.fetchJS(e,[s],"component").then(e=>{Object.keys(this._options.components).map(t=>{this._options.components[t]===s&&this._navimiComponents.registerComponent(t,e)})})));return Promise.all(t)}},this.initJS=async(t,e)=>{const s=this.getInstance(t);s&&s.init&&await s.init(e)}}init(t,e,s,i,r,n,a){this._navimiHelpers=t,this._navimiFetch=e,this._navimiCSSs=s,this._navimiTemplates=i,this._navimiState=r,this._navimiComponents=n,this._options=a,this._navimiLoader=window[this._navimiLoaderNS]={[this._callBackNS]:this._instantiateJS}}}class __Navimi_Middlewares{constructor(){this._middlewareStack=[],this.addMiddlewares=t=>{Array.isArray(t)&&this._middlewareStack.push(...t.filter(t=>void 0!==t))},this.executeMiddlewares=async(n,e,a)=>{let o;const h=async(s,i,r=0)=>{o=r;const t=this._middlewareStack[r];if(t)try{await t(e,async(t,e)=>{n&&n.signal.aborted?s():t?(a(t,e),s()):await h(s,i,r+1)})}catch(t){i(t)}else s()};return new Promise(h)}}}class Navimi{constructor(t,e,s,i){const r=null!=(h=null==s?void 0:s.navimiFetch)?h:new __Navimi_Fetch,n=null!=(h=null==s?void 0:s.navimiCSSs)?h:new __Navimi_CSSs,a=null!=(h=null==s?void 0:s.navimiJSs)?h:new __Navimi_JSs,o=null!=(h=null==s?void 0:s.navimiTemplates)?h:new __Navimi_Templates;var h=null!=(h=null==s?void 0:s.navimiMiddlewares)?h:new __Navimi_Middlewares;const l=null!=(c=null==s?void 0:s.navimiState)?c:new __Navimi_State;var c=null!=(c=null==s?void 0:s.navimiHot)?c:new __Navimi_Hot,m=null!=(m=null==s?void 0:s.navimiHelpers)?m:new __Navimi_Helpers;const _=null!=(s=null==s?void 0:s.navimiComponents)?s:new __Navimi_Components;r.init(e),n.init(r),a.init(m,r,n,o,l,_,e),o.init(r),l.init(m),_.init(m);s={navimiFetch:r,navimiJSs:a,navimiCSSs:n,navimiTemplates:o,navimiMiddlewares:h,navimiState:l,navimiHot:c,navimiHelpers:m,navimiComponents:_};return i?i(t,s,e):new __Navimi_Core(t,s,e)}}class __Navimi_State{constructor(){this.state={},this.stateWatchers={},this.prevState={},this.stateDiff={},this._navimiHelpers={},this.getStateDiff=t=>{t.sort((t,e)=>e.length-t.length).map(e=>{this.stateDiff[e]||this._navimiHelpers.stringify(this.getState(e,this.prevState)||"")!==this._navimiHelpers.stringify(this.getState(e,this.state)||"")&&(this.stateDiff[e]=!0,t.map(t=>{e!==t&&0===e.indexOf(t)&&(this.stateDiff[t]=!0)}))})},this.mergeState=(t,e)=>{e instanceof Error&&(e=Object.assign(Object.assign({},e),{message:e.message,stack:e.stack}));var s=t=>t&&"object"==typeof t&&!Array.isArray(t)&&null!==t;if(s(t)&&s(e))for(const i in e)s(e[i])?(t[i]||Object.assign(t,{[i]:{}}),this.mergeState(t[i],e[i])):Object.assign(t,{[i]:e[i]})},this.setState=t=>{var e=Object.keys(this.stateWatchers);0<e.length&&(this.prevState=this._navimiHelpers.cloneObject(this.state)),this.mergeState(this.state,t),0<e.length&&(this.getStateDiff(e),this.invokeStateWatchers())},this.getState=(t,e)=>{t=t?t.split(".").reduce((t,e)=>t&&t[e]||void 0,e||this.state):e||this.state;return t?Object.freeze(this._navimiHelpers.cloneObject(t)):void 0},this.watchState=(t,e,s)=>{e&&s&&(this.stateWatchers[e]||(this.stateWatchers[e]={}),this.stateWatchers[e]=Object.assign(Object.assign({},this.stateWatchers[e]),{[t]:[...this.stateWatchers[e][t]||[],s]}))},this.unwatchState=(e,t)=>{const s=t=>{this.stateWatchers[t][e]=void 0,delete this.stateWatchers[t][e],0===Object.keys(this.stateWatchers[t]).length&&delete this.stateWatchers[t]};if(t){const i=Array.isArray(t)?t:[t];void i.map(t=>{this.stateWatchers[t]||(this.stateWatchers[t]={}),s(t)})}else Object.keys(this.stateWatchers).map(s)},this.clear=t=>{const e=Array.isArray(t)?t:[t];console.log("clear",e),e.map(e=>{const s=e?e.split(".").reduce((t,e)=>t&&t[e]||void 0,this.state):this.state;console.log(e),s instanceof Object&&Object.keys(s).map(t=>{s[t]instanceof Object&&this.clear(e+"."+t),delete s[t]})})}}init(t){this._navimiHelpers=t,this.invokeStateWatchers=t.debounce(()=>{const t=Object.keys(this.stateWatchers),e=Object.keys(this.stateDiff);this.stateDiff={},t.filter(t=>0<=e.indexOf(t)).sort((t,e)=>e.length-t.length).map(s=>{Object.keys(this.stateWatchers[s]).map(t=>{const e=this.getState(s);this.stateWatchers[s][t]&&this.stateWatchers[s][t].map(t=>t&&t(e))})})},10)}}class __Navimi_Templates{constructor(){this._templatesCache={},this._loadedTemplates={},this.loadTemplate=(t,e)=>{let s=t;if(this._regIni.exec(s))for(;t&&0<t.length;){var i=this._regIni.exec(s);if(!i||0===i.length)break;const n=this._regId.exec(i[1]);var r=0<n.length&&n[1].slice(1,-1),i=(s=s.substring(i.index+i[0].length),this._regEnd.exec(s));if(!r||!i||0===i.length)break;this._templatesCache[r]=s.substring(0,i.index)}else this._templatesCache[e]=s},this.isTemplateLoaded=t=>void 0!==this._loadedTemplates[t],this.getTemplate=t=>{const e=Array.isArray(t)?t:[t];t=e.map(t=>this._templatesCache[t]);return 1<t.length?t:t[0]},this.fetchTemplate=(t,e)=>{var s=e=>!e||this._loadedTemplates[e]?Promise.resolve():this._navimiFetch.fetchFile(e,{headers:{Accept:"text/html"},signal:t?t.signal:void 0}).then(t=>{this.loadTemplate(t,e),this._loadedTemplates[e]=!0});const i=Array.isArray(e)?e:[e];return 1<i.length?Promise.all(i.map(s)):s(i[0])}}init(t){this._navimiFetch=t,this._regIni=new RegExp("<t ([^>]+)>"),this._regEnd=new RegExp("</t>"),this._regId=new RegExp("id=(\"[^\"]+\"|'[^']+')")}}