/**
 * Navimi v0.2.1 
 * Developed by Ivan Valadares 
 * ivanvaladares@hotmail.com 
 * https://github.com/ivanvaladares/navimi 
 */ 
var __Navimi_Helpers,__Navimi;!function(t){t.Navimi_Core=class{constructor(t,i,e){this.navigateTo=(t,i)=>{this.initRoute(t,i)},this.reportError=t=>{this.options.onError?this.options.onError(t):console.error(t)},this.initRoute=async(t,i,c)=>{var e=__Navimi_Helpers.removeHash(t||__Navimi_Helpers.getUrl());if(!c){if(this.currentUrl===e)return;this.abortController.abort(),this.abortController=new AbortController}var s=++this.callId,m=void 0!==t;let{routeItem:a,params:r}=__Navimi_Helpers.getRouteAndParams(e,this.routesList);if((void 0!==i&&(r=Object.assign(Object.assign({},r),i)),this.options.onBeforeRoute)&&!1===await this.options.onBeforeRoute({url:e,routeItem:a,params:r},this.navigateTo))return;if(this.currentJS&&!c){const l=this.navimiJs.getInstance(this.currentJS);if(l){const u=l.beforeLeave;if(u)if(!1===u({url:e,routeItem:a,params:r}))return void(m||history.forward());l.destroy&&l.destroy()}}if(a){if(await this.navimiMiddleware.executeMiddlewares(this.abortController,{url:e,routeItem:a,params:r},(t,i)=>{this.initRoute(t,i,!0)}),!(s<this.callId)){this.currentUrl=e;try{var{title:d,jsUrl:n,cssUrl:o,templatesUrl:h,dependsOn:v}=a||{};if(!n&&!h)throw new Error("The route must define the 'jsUrl' or 'templatesUrl'!");n&&(this.currentJS=n,this.routesParams[n]={url:e,routeItem:a,params:r}),m&&(null!=i&&i.replaceUrl?history.replaceState(null,null,t):history.pushState(null,null,t)),this.navimiCss.fetchCss(this.abortController,o).catch(t=>{}),this.navimiTemplates.fetchTemplate(this.abortController,[h]).catch(t=>{});try{this.navimiJs.loadServices(this.abortController,n,v)}catch(t){this.reportError(t)}for(n&&await this.navimiJs.fetchJS(this.abortController,[n],!1);o&&!this.navimiCss.isCssLoaded(o)||h&&!this.navimiTemplates.isTemplateLoaded(h)||this.options.globalCssUrl&&!this.navimiCss.isCssLoaded(this.options.globalCssUrl)||this.options.globalTemplatesUrl&&!this.navimiTemplates.isTemplateLoaded(this.options.globalTemplatesUrl);){if(await __Navimi_Helpers.timeout(10),s<this.callId)return;if(o&&this.navimiFetch.loadErrors[o]||h&&this.navimiFetch.loadErrors[h]||this.options.globalCssUrl&&this.navimiFetch.loadErrors[this.options.globalCssUrl]||this.options.globalTemplatesUrl&&this.navimiFetch.loadErrors[this.options.globalTemplatesUrl])return void this.reportError(new Error(this.navimiFetch.loadErrors[o]||this.navimiFetch.loadErrors[h]||this.navimiFetch.loadErrors[this.options.globalCssUrl]||this.navimiFetch.loadErrors[this.options.globalTemplatesUrl]))}this.navimiDom.setTitle(d);try{if(!n){var p=this.navimiTemplates.getTemplate(h);const f=document.querySelector("body");return void(p&&f&&(f.innerHTML=p))}await this.navimiJs.initJS(n,this.routesParams[n])}catch(t){this.reportError(t)}finally{if(s<this.callId)return;this.navimiDom.setNavimiLinks(),this.navimiDom.insertCss(this.navimiCss.getCss(o),"routeCss"),this.options.onAfterRoute&&this.options.onAfterRoute({url:e,routeItem:a,params:r},this.navigateTo)}}catch(t){this.reportError(t)}}}else s===this.callId&&this.reportError(new Error("No route match for url: "+e))},this.callId=0,this.abortController=new AbortController,this.currentJS=void 0,this.currentUrl=void 0,this.routesParams={},this.routesList=t||{},this.options=i||{},this.win=window||{},this.navimiFetch=e.navimiFetch,this.navimiDom=e.navimiDom,this.navimiCss=e.navimiCss,this.navimiJs=e.navimiJs,this.navimiTemplates=e.navimiTemplates,this.navimiMiddleware=e.navimiMiddleware,this.win.addEventListener("popstate",()=>{this.initRoute()}),this.win.navigateTo=this.navigateTo,this.navimiMiddleware.addMiddlewares(this.options.middlewares),(async()=>{await this.init()})(),this.initRoute(),this.options.hot&&this.initHot()}async init(){(this.options.globalCssUrl||this.options.globalTemplatesUrl)&&(await Promise.all([this.navimiCss.fetchCss(void 0,this.options.globalCssUrl),this.navimiTemplates.fetchTemplate(void 0,[this.options.globalTemplatesUrl])]).catch(this.reportError),this.navimiDom.insertCss(this.navimiCss.getCss(this.options.globalCssUrl),"globalCss"))}initHot(){console.warn("HOT is disabled! Use the unminified version to enable it.")}}}(__Navimi=__Navimi||{}),function(t){t.Navimi_CSSs=class{constructor(){this.loadedCsss={},this.isCssLoaded=t=>void 0!==this.loadedCsss[t],this.getCss=t=>this.loadedCsss[t],this.fetchCss=(s,a,r)=>new Promise(async(t,i)=>{if(!a||this.loadedCsss[a])return t();try{var e=await this.navimiFetch.fetchFile(a,{headers:{Accept:"text/css"},signal:s?s.signal:void 0});r?(this.domFunctions.insertCss(e,a,!0),this.loadedCsss[a]="loaded"):this.loadedCsss[a]=e,t()}catch(t){i(t)}}),this.reloadCss=(t,i,e,s,a)=>{const r=__Navimi_Helpers.isSameFile;if(r(a,t))return console.log(t+" updated."),this.loadedCsss[a]=i,void this.domFunctions.insertCss(i,"globalCss");for(const h in e){var{jsUrl:n,cssUrl:o}=e[h];if(r(o,t))return console.log(t+" updated."),this.loadedCsss[o]=i,void(s===n&&this.domFunctions.insertCss(i,"routeCss"))}}}init(t,i){this.domFunctions=t,this.navimiFetch=i}}}(__Navimi=__Navimi||{});const __NAVIMI_DEV=!0,__NAVIMI_PROD=!1;!function(t){t.Navimi_Dom=class{constructor(){this.setTitle=t=>{document.title=t},this.setNavimiLinks=()=>{document.querySelectorAll("[navimi-link]").forEach(t=>{t.removeAttribute("navimi-link"),t.setAttribute("navimi-linked",""),t.addEventListener("click",t=>{t.preventDefault(),window.navigateTo(t.target.pathname)})})},this.insertCss=(t,i,e)=>{const s=i?document.querySelector(`[cssId='${i}']`):void 0;if(s&&s.remove(),t){const a=document.createElement("style");a.innerHTML=t,i&&a.setAttribute("cssId",i);const r=document.getElementsByTagName("head")[0]||document.body;e?r.prepend(a):r.appendChild(a)}},this.insertJS=(t,i)=>{const e=document.querySelector(`[jsUrl='${i}']`),s=(e&&e.remove(),document.createElement("script")),a=(s.type="text/javascript",s.innerHTML=t,s.setAttribute("jsUrl",i),document.getElementsByTagName("head")[0]);(a||document.body).appendChild(s)},this.addLibrary=async t=>{let i=Array.isArray(t)?t:[t];0<(i=i.filter(t=>!this.jsFunctions.isJsLoaded(t))).length&&await Promise.all(i.map(t=>{const i=t.split(".").pop();if("css"!==i.toLowerCase())return this.jsFunctions.fetchJS(void 0,[t]);this.cssFunctions.fetchCss(void 0,t,!0)})).catch(t=>{throw new Error(t)})}}init(t,i){this.cssFunctions=t,this.jsFunctions=i}}}(__Navimi=__Navimi||{}),function(t){t.Navimi_Fetch=class{constructor(){this.loadErrors={},this.init=(t,i)=>{this.bustCache=t.bustCache,this.fetch=i},this.fetchFile=(a,i)=>new Promise((e,s)=>{delete this.loadErrors[a];var t=a+(this.bustCache?"?v="+this.bustCache:"");(this.fetch||fetch)(t,i).then(async t=>{var i;if(!t||!t.ok)return this.loadErrors[a]=i="Could not load the file! - "+a,s(i);e(await t.text())}).catch(t=>{this.loadErrors[a]=t.message,s(t)})})}}}(__Navimi=__Navimi||{}),function(s){const h=t=>{if(!t)return[];var i=t.indexOf("?");return(t=0<=i?t.substr(0,i):t).split("/").filter(t=>0<t.length)},l=(t,i)=>{var e=t.indexOf("?"),s=0<e?t.substr(e+1,t.length):"";const a=h(t),r=h(i);let n={};0<e&&(n={queryString:(t=>{const i={};return t.split("&").map(t=>{t=t.split("=");i[decodeURIComponent(t[0])]=decodeURIComponent(t[1]||"")}),i})(s)});for(let t=0;t<r.length;t++)if(":"===r[t].charAt(0)){var o=r[t].slice(1);if(a.length<=t)return null;n[o]=decodeURIComponent(a[t])}else if(!a[t]||r[t].toLowerCase()!==a[t].toLowerCase())return null;return n};s.isSameFile=(t,i)=>t&&i&&t.split("?").shift().toLowerCase()==i.split("?").shift().toLowerCase(),s.timeout=i=>new Promise(t=>setTimeout(t,i)),s.debounce=(t,i)=>{let e;return function(){clearTimeout(e),e=setTimeout(()=>{e=null,t.apply(this,arguments)},i)}},s.getUrl=()=>{const t=document.location;var i=t.toString().match(/^[^#]*(#.+)$/);const e=i?i[1]:"";return[t.pathname,t.search,e].join("")},s.removeHash=t=>{var i=t.indexOf("#");return 0<i?t.substr(0,i):t},s.stringify=t=>{const i=[],s=e=>{if("function"==typeof e)return String(e);if(e instanceof Error)return e.message;if(null===e||"object"!=typeof e)return e;if(-1!==i.indexOf(e))return`[Circular: ${i.indexOf(e)}]`;if(i.push(e),Array.isArray(e))return t=e.map(s),i.pop(),t;var t=Object.keys(e).reduce((t,i)=>(t[i]=s(((t,i)=>{if(Object.prototype.hasOwnProperty.call(t,i))try{return t[i]}catch(t){return}return t[i]})(e,i)),t),{});return i.pop(),t};return JSON.stringify(s(t))},s.cloneObject=e=>null===e||"object"!=typeof e?e:Object.keys(e).reduce((t,i)=>(null!==e[i]&&"object"==typeof e[i]?t[i]=s.cloneObject(e[i]):t[i]=e[i],t),Array.isArray(e)?[]:{}),s.getRouteAndParams=(t,i)=>{var e=h(t),s=i["*"];let a,r;for(const o in i){var n=h(o);if(n.length===e.length&&(r=l(t,o))){a=i[o];break}}return{routeItem:a=!a&&s?s:a,params:r}}}(__Navimi_Helpers=__Navimi_Helpers||{}),function(t){t.Navimi_hot=class{constructor(t){this.openHotWs=(t,i)=>{},this.digestHot=(t,i,e,s,a,r)=>{},this.hotFunctions=t}}}(__Navimi=__Navimi||{}),function(t){t.Navimi_JSs=class{constructor(){this.navimiLoaderNS="__navimiLoader",this.callBackNS="_jsLoaderCallback",this.promiseNS="_promise_",this.loadedJSs={},this.externalJSs={},this.routesJSs={},this.dependencyJSsMap={},this.routesJSsServices={},this.domFunctions={},this.navimiFetch={},this.navimiTemplates={},this.awaitJS=s=>new Promise((t,i)=>{const e=setInterval(()=>this.routesJSs[s]?(clearInterval(e),t(this.routesJSs[s])):void 0===this.navimiLoader[this.promiseNS+s]?(clearInterval(e),i("Error loading file! "+s)):void 0,50)}),this.fetch=(s,a,r)=>new Promise(async(i,e)=>{try{let t;t="string"==typeof this.loadedJSs[a]?this.loadedJSs[a]:await this.navimiFetch.fetchFile(a,{headers:{Accept:"application/javascript"},signal:s?s.signal:void 0}),this.insertJS(a,t,r),void 0===r&&this.navimiLoader[this.promiseNS+a](!0),i()}catch(t){e(t)}}),this.insertJS=(t,i,e)=>{var s=void 0!==e?`(function(){window.${this.navimiLoaderNS}.${this.callBackNS}("${t}", ${e}, (function(){return ${i}   
                })())}())`:i;this.loadedJSs[t]=!!e||i,this.domFunctions.insertJS(s,t)},this.instantiateJS=async(e,t,s)=>{const a=this.navimiLoader[this.promiseNS+e],i=this.navimiLoader[this.promiseNS+e+"_reject"];if(setTimeout(()=>{delete this.navimiLoader[this.promiseNS+e],delete this.navimiLoader[this.promiseNS+e+"_reject"]},10),t)return this.externalJSs[e]=s,void(a&&a(Object.freeze(s)));try{this.navimiState.unwatchState(e);var r=Object.freeze({addLibrary:this.domFunctions.addLibrary,setTitle:this.domFunctions.setTitle,navigateTo:window.navigateTo,getTemplate:this.navimiTemplates.getTemplate,fetchJS:t=>{const i=Array.isArray(t)?t:[t];return i.map(t=>{this.dependencyJSsMap[t]=Object.assign(Object.assign({},this.dependencyJSsMap[t]||{}),{[e]:!0})}),this.fetchJS(void 0,i,!0)},fetchTemplate:t=>{t=Array.isArray(t)?t:[t];return this.navimiTemplates.fetchTemplate(void 0,t,e)},setState:this.navimiState.setState,getState:this.navimiState.getState,setNavimiLinks:this.domFunctions.setNavimiLinks,unwatchState:t=>this.navimiState.unwatchState(e,t),watchState:(t,i)=>this.navimiState.watchState(e,t,i)});let i;if(this.routesJSsServices[e]&&0<this.routesJSsServices[e].length){for(;;){if(-1===this.routesJSsServices[e].map(t=>void 0===this.externalJSs[this.options.services[t]]).indexOf(!0))break;if(this.routesJSsServices[e].map(t=>this.options.services[t]).find(t=>this.navimiFetch.loadErrors[t]))return;await __Navimi_Helpers.timeout(10)}this.routesJSsServices[e].map(t=>{i=Object.assign(Object.assign({},i),{[t]:this.externalJSs[this.options.services[t]]})})}var n=new s(r,i);this.routesJSs[e]=n,a&&a(n)}catch(t){i&&i(t)}},this.isJsLoaded=t=>void 0!==this.loadedJSs[t],this.getInstance=t=>this.routesJSs[t],this.fetchJS=(s,t,a)=>{var i=e=>new Promise(async(t,i)=>a&&this.externalJSs[e]?t(this.externalJSs[e]):this.routesJSs[e]?t(this.routesJSs[e]):void(this.navimiLoader[this.promiseNS+e]?await this.awaitJS(e).then(t).catch(i):(this.navimiLoader[this.promiseNS+e]=t,this.navimiLoader[this.promiseNS+e+"_reject"]=i,this.fetch(s,e,a).catch(t=>{this.navimiLoader[this.promiseNS+e+"_reject"](t)}))));return 1<t.length?Promise.all(t.map(i)):i(t[0])},this.loadServices=(i,s,t)=>{if(s&&t&&0!==t.length&&(this.routesJSsServices[s]=this.routesJSsServices[s]||[],t&&0<t.length)){let e=[];const a=t.map(t=>{var i=this.options.services&&this.options.services[t];return void 0===i?e.push(t):(-1===this.routesJSsServices[s].indexOf(t)&&this.routesJSsServices[s].push(t),this.dependencyJSsMap[i]=Object.assign(Object.assign({},this.dependencyJSsMap[i]||{}),{[s]:!0})),i});if(0<e.length)throw new Error("Service(s) not defined: "+e.join(", "));Promise.all(a.filter(t=>void 0!==t).map(t=>this.fetchJS(i,[t],!0)))}},this.initJS=async(t,i)=>{const e=this.getInstance(t);e&&e.init&&await e.init(i)},this.reloadJs=(t,i,e,s,a)=>{const r=__Navimi_Helpers.isSameFile;for(const n in e){const o=e[n]["jsUrl"];if(r(o,t))return console.log(t+" updated."),delete this.routesJSs[o],this.navimiLoader[this.promiseNS+o]=()=>{o===s&&a()},void this.insertJS(o,i,!1)}for(const h in this.dependencyJSsMap)r(h,t)&&(console.log(t+" updated."),delete this.externalJSs[h],this.navimiLoader[this.promiseNS+h]=()=>{Object.keys(this.dependencyJSsMap[h]).map(t=>{delete this.routesJSs[t],t===s&&a()})},this.insertJS(t,i,!0))}}init(t,i,e,s,a){this.domFunctions=t,this.navimiFetch=i,this.navimiTemplates=e,this.navimiState=s,this.options=a,this.navimiLoader=window[this.navimiLoaderNS]={[this.callBackNS]:this.instantiateJS}}}}(__Navimi=__Navimi||{}),function(t){t.Navimi_Middleware=class{constructor(){this.middlewareStack=[],this.addMiddlewares=t=>{Array.isArray(t)&&this.middlewareStack.push(...t.filter(t=>void 0!==t))},this.executeMiddlewares=async(r,i,n)=>{let o=-1;const h=async(e,s,a=0)=>{o=a;const t=this.middlewareStack[a];t?await t(i,async(t,i)=>{r.signal.aborted?s():t?(s(),n(t,i)):await h(e,s,a+1)}):e()};await new Promise(await h).catch(t=>{})}}}}(__Navimi=__Navimi||{});class Navimi{constructor(t,i){const e=new __Navimi.Navimi_Fetch,s=new __Navimi.Navimi_Dom,a=new __Navimi.Navimi_CSSs,r=new __Navimi.Navimi_JSs,n=new __Navimi.Navimi_Templates;var o=new __Navimi.Navimi_Middleware,h=new __Navimi.Navimi_State,t=(e.init(i),a.init(s,e),s.init(a,r),r.init(s,e,n,h,i),n.init(e),new __Navimi.Navimi_Core(t,i,{navimiFetch:e,navimiJs:r,navimiCss:a,navimiDom:s,navimiTemplates:n,navimiMiddleware:o,navimiState:h}));return t}}!function(t){t.Navimi_State=class{constructor(){this.state={},this.stateWatchers={},this.prevState={},this.stateDiff={},this.getStateDiff=t=>{t.sort((t,i)=>i.length-t.length).map(i=>{this.stateDiff[i]||__Navimi_Helpers.stringify(this.getState(i,this.prevState)||"")!==__Navimi_Helpers.stringify(this.getState(i,this.state)||"")&&(this.stateDiff[i]=!0,t.map(t=>{i!==t&&0===i.indexOf(t)&&(this.stateDiff[t]=!0)}))})},this.invokeStateWatchers=__Navimi_Helpers.debounce(()=>{const t=Object.keys(this.stateWatchers),i=Object.keys(this.stateDiff);this.stateDiff={},t.filter(t=>i.includes(t)).sort((t,i)=>i.length-t.length).map(e=>{Object.keys(this.stateWatchers[e]).map(t=>{const i=this.getState(e);this.stateWatchers[e][t]&&this.stateWatchers[e][t].map(t=>t&&t(i))})})},10),this.mergeState=(t,i)=>{i instanceof Error&&(i=Object.assign(Object.assign({},i),{message:i.message,stack:i.stack}));var e=t=>t&&"object"==typeof t&&!Array.isArray(t)&&null!==t;if(e(t)&&e(i))for(const s in i)e(i[s])?(t[s]||Object.assign(t,{[s]:{}}),this.mergeState(t[s],i[s])):Object.assign(t,{[s]:i[s]})},this.setState=t=>{var i=Object.keys(this.stateWatchers);0<i.length&&(this.prevState=__Navimi_Helpers.cloneObject(this.state)),this.mergeState(this.state,t),0<i.length&&(this.getStateDiff(i),this.invokeStateWatchers())},this.getState=(t,i)=>{t=t?t.split(".").reduce((t,i)=>t&&t[i]||void 0,i||this.state):i||this.state;return t?Object.freeze(__Navimi_Helpers.cloneObject(t)):void 0},this.watchState=(t,i,e)=>{i&&e&&(this.stateWatchers[i]||(this.stateWatchers[i]={}),this.stateWatchers[i]=Object.assign(Object.assign({},this.stateWatchers[i]),{[t]:[...this.stateWatchers[i][t]||[],e]}))},this.unwatchState=(i,t)=>{const e=t=>{this.stateWatchers[t][i]=void 0,delete this.stateWatchers[t][i],0===Object.keys(this.stateWatchers[t]).length&&delete this.stateWatchers[t]};if(t){const s=Array.isArray(t)?t:[t];void s.map(t=>{this.stateWatchers[t]||(this.stateWatchers[t]={}),e(t)})}else Object.keys(this.stateWatchers).map(e)}}}}(__Navimi=__Navimi||{}),function(t){t.Navimi_Templates=class{constructor(){this.templatesCache={},this.loadedTemplates={},this.dependencyTemplatesMap={},this.navimiFetch={},this.loadTemplate=(t,i)=>{const e=new RegExp("<t ([^>]+)>"),s=new RegExp("</t>"),a=new RegExp('id="([^"]+)"');let r=t;if(e.exec(r))for(;t&&0<t.length;){var n=e.exec(r);if(!n||0===n.length)break;var o=a.exec(n[1]),o=0<o.length&&o[1],n=(r=r.substr(n.index+n[0].length),s.exec(r));if(!o||!n||0===n.length)break;this.templatesCache[o]=r.substr(0,n.index)}else this.templatesCache[i]=r},this.isTemplateLoaded=t=>void 0!==this.loadedTemplates[t],this.getTemplate=t=>{const i=Array.isArray(t)?t:[t];t=i.map(t=>this.templatesCache[t]);return 1<t.length?t:t[0]},this.fetchTemplate=(a,t,i)=>{var e=s=>new Promise(async(t,i)=>{if(!s||this.loadedTemplates[s])return t();try{var e=await this.navimiFetch.fetchFile(s,{headers:{Accept:"text/html"},signal:a?a.signal:void 0});this.loadTemplate(e,s),this.loadedTemplates[s]=!0,t()}catch(t){i(t)}});return i&&t.map(t=>{this.dependencyTemplatesMap[t]=Object.assign(Object.assign({},this.dependencyTemplatesMap[t]||{}),{[i]:!0})}),1<t.length?Promise.all(t.map(e)):e(t[0])},this.reloadTemplate=(t,i,e,s,a,r)=>{const n=__Navimi_Helpers.isSameFile;if(n(a,t))return console.log(t+" updated."),this.loadTemplate(i,a),void r();for(const h in e){var{jsUrl:c,templatesUrl:o}=e[h];if(n(o,t))return console.log(t+" updated."),this.loadTemplate(i,o),void(s===c&&r())}for(const l in this.dependencyTemplatesMap)n(l,t)&&(console.log(t+" updated."),this.loadTemplate(i,l),Object.keys(this.dependencyTemplatesMap[l]).map(t=>{t===s&&r()}))}}init(t){this.navimiFetch=t}}}(__Navimi=__Navimi||{});