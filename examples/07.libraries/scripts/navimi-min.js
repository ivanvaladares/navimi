var Navimi=function(){"use strict";class d{constructor(t,e,s){this._navigateTo=(t,e)=>{this._initRoute(t,e)},this._reportError=t=>{this._options.onError?this._options.onError(t):console.error(t)},this._waitForAssets=i=>{const r=this._options.globalCssUrl,n=this._options.globalTemplatesUrl;return r||n?new Promise(e=>{const s=setInterval(()=>{let t=!0;if((r&&!this._navimiCSSs.isCssLoaded(r)||n&&!this._navimiTemplates.isTemplateLoaded(n))&&(t=!1),this._navimiFetch.getErrors(r)||this._navimiFetch.getErrors(n)||t||i<this._callId)return clearInterval(s),e()},10)}):Promise.resolve()},this._initRoute=async(t,e,s)=>{try{var i=this._navimiHelpers.removeHash(t||this._navimiHelpers.getUrl());if(!s){if(this._currentUrl===i)return;this._abortController&&this._abortController.abort(),this._abortController=window.AbortController?new AbortController:void 0}var r=++this._callId,n=void 0!==t,{routeItem:a,params:o}=this._navimiHelpers.getRouteAndParams(i,this._routesList),h=Object.assign({url:i,routeItem:a,params:o},e||{});if(!s){if(this._options.onBeforeRoute)if(!1===await this._options.onBeforeRoute(h,this._navigateTo))return;if(this._currentJSUrl){const v=this._navimiJSs.getInstance(this._currentJSUrl);if(v){const g=v.onBeforeLeave;if(g)if(!1===g(h))return void(n||history.forward());v.onLeave&&v.onLeave()}}}if(!a)return void(r===this._callId&&this._reportError(new Error("No route match for url: "+i)));if(await this._navimiMiddlewares.executeMiddlewares(this._abortController,h,(t,e)=>{this._initRoute(t,e,!0)}).catch(this._reportError),r<this._callId)return;this._currentUrl=i;var{title:l,jsUrl:c,cssUrl:m,templatesUrl:_,services:d,components:p}=a||{};if(!c&&!_)throw new Error("The route must define the 'jsUrl' or 'templatesUrl'!");if(c&&(this._currentJSUrl=c,this._routesParams[c]=h),n&&(e&&e.replaceUrl?history.replaceState(null,null,t):history.pushState(null,null,t)),await Promise.all([this._navimiJSs.loadServices(this._abortController,c||i,d),this._navimiJSs.loadComponents(this._abortController,c||i,p),this._navimiCSSs.fetchCss(this._abortController,m),this._navimiTemplates.fetchTemplate(this._abortController,_),c&&this._navimiJSs.fetchJS(this._abortController,[c],"route")]).catch(this._reportError),await this._waitForAssets(r),this._navimiHelpers.setTitle(l),this._globalCssInserted||(this._globalCssInserted=!0,this._navimiCSSs.insertCss(this._options.globalCssUrl,"globalCss")),c)await this._navimiJSs.initRoute(c,this._routesParams[c]);else{var u=this._navimiTemplates.getTemplate(_);const f=document.querySelector("body");u&&f&&(f.innerHTML=u)}r===this._callId&&(this._navimiHelpers.setNavimiLinks(),this._navimiCSSs.insertCss(m,"routeCss"),this._options.onAfterRoute&&this._options.onAfterRoute(h,this._navigateTo))}catch(t){this._reportError(t)}},this._callId=0,this._abortController=window.AbortController?new AbortController:void 0,this._currentJSUrl,this._currentUrl,this._routesParams={},this._routesList=t||{},this._options=s||{},this._globalCssInserted=!1,this._win=window||{},this._navimiFetch=e.navimiFetch,this._navimiCSSs=e.navimiCSSs,this._navimiJSs=e.navimiJSs,this._navimiTemplates=e.navimiTemplates,this._navimiMiddlewares=e.navimiMiddlewares,this._navimiHot=e.navimiHot,this._navimiHelpers=e.navimiHelpers,this._win.addEventListener("popstate",()=>{this._initRoute()}),this._win.navigateTo=this._navigateTo,this._navimiMiddlewares.addMiddlewares(this._options.middlewares),(async()=>{await this._init()})(),this._initRoute(),this._options.hot&&this._initHot()}_init(){if(this._options.globalCssUrl||this._options.globalTemplatesUrl)return Promise.all([this._navimiCSSs.fetchCss(void 0,this._options.globalCssUrl),this._navimiTemplates.fetchTemplate(void 0,this._options.globalTemplatesUrl)]).catch(this._reportError)}_initHot(){}}class p{constructor(){this.loadErrors={},this.init=t=>{this._bustCache=t.bustCache},this.getErrors=t=>this.loadErrors[t],this.fetchFile=(r,n)=>new Promise((e,s)=>{delete this.loadErrors[r];var t=r+(this._bustCache?"?v="+this._bustCache:"");const i="Could not load the file! - "+r;fetch(t,n).then(t=>{if(!t||!t.ok)return this.loadErrors[r]=i,s(i);t.text().then(e)}).catch(()=>{this.loadErrors[r]=i,s(i)})})}}class u{constructor(){this._loadedCsss={},this._cssRulesCache={},this._cssCount=0,this._atomicCssId="__navimi__cssInJs__",this._replaceCss=(t,e)=>{const s=document.querySelector(`[cssUrl='${e}']`);s&&(s.innerHTML=t)},this._insertCssRule=({className:t,child:e,media:s,cssRule:i})=>{this._cssSheet||(r=document.querySelector(`style[id=${this._atomicCssId}]`),this._cssSheet=r.sheet);var r=`.${""+t+e}{${i.join(";")}}`;this._cssSheet.insertRule(s?s+`{${r}}`:r,this._cssSheet.cssRules.length)},this._addCssToDom=(t,e,s)=>{if(document){const i=document.createElement("style");i.innerHTML=t,s&&Object.entries(s).forEach(([t,e])=>{i.setAttribute(t,e)});const r=document.getElementsByTagName("head")[0]||document.body;e?r.insertBefore(i,r.firstChild):r.appendChild(i)}},this._parseCssRules=(t,n="",a="")=>Object.entries(t).reduce((t,[e,s])=>{var i,r;return s&&"object"==typeof s?(r=(i=/^@/.test(e)?e:null)?n:n+e.replace(/&/g,""),t.concat(this._parseCssRules(s,r,i||a))):t.concat({media:a,child:n,cssRule:[e+":"+s]})},[]),this.isCssLoaded=t=>void 0!==this._loadedCsss[t],this.fetchCss=(t,e)=>!e||this._loadedCsss[e]?Promise.resolve():this._navimiFetch.fetchFile(e,{headers:{Accept:"text/css"},signal:t?t.signal:void 0}).then(t=>{this._loadedCsss[e]=t}),this.insertCss=(t,e,s)=>{if("routeCss"===e){const r=document.querySelector(`[cssType='${e}']`);if(r){if(r.getAttribute("cssUrl")===t)return;r.remove()}}var i;document.querySelector(`[cssUrl='${t}']`)||(i=this._loadedCsss[t])&&this._addCssToDom(i,s,{cssUrl:t,cssType:e})},this.style=(...t)=>t.map(t=>this._parseCssRules(t).map(t=>{var e=JSON.stringify(t);if(this._cssRulesCache[e])return this._cssRulesCache[e];var s="__navimi_"+this._cssCount++;return this._insertCssRule(Object.assign(Object.assign({},t),{className:s})),this._cssRulesCache[e]=s}).join(" ")).join("")}init(t){this._navimiFetch=t,this._addCssToDom("",!0,{id:this._atomicCssId})}}class v{constructor(){this._navimiLoaderNS="__navimiLoader",this._callBackNS="_jsLoaderCallback",this._promiseNS="_promise_",this._loadedJSs={},this._jsType={},this._jsInstances={},this._jsDepMap={},this._servicesList={},this._uidCounter=0,this._resolvePromise=(t,e)=>{this._navimiLoader[this._promiseNS+e](t)},this._rejectPromise=(t,e)=>{this._navimiLoader[this._promiseNS+e+"_reject"](t)},this._awaitJS=r=>new Promise((e,s)=>{const i=setInterval(()=>{if(this._jsInstances[r])return clearInterval(i),e(this._jsInstances[r]);var t=this._jsType[r];if(("library"===t||"module"===t)&&this.isJsLoaded(r))return clearInterval(i),e("");t=this._navimiFetch.getErrors(r);return t?(clearInterval(i),s(t)):void 0},10)}),this._addLibrary=async t=>{const e=Array.isArray(t)?t:[t];if(0<e.length){const s=e.map(t=>{if("string"!=typeof t)return t;{const e=t.split(".").pop();return{url:t,type:e.toLowerCase()}}});await Promise.all(s.map(t=>{var e=t.type.toLowerCase();return"css"===e?this._navimiCSSs.fetchCss(void 0,t.url).then(()=>this._navimiCSSs.insertCss(t.url,"library",!0)):this.fetchJS(void 0,[t.url],"module"===e?"module":"library")})).catch(t=>{throw new Error(t)})}},this._fetch=async(t,e,s)=>{let i="";i=this._loadedJSs[e]||await this._navimiFetch.fetchFile(e,{headers:{Accept:"application/javascript"},signal:t?t.signal:void 0}),this._jsType[e]=s,this._insertJS(e,i.replace(/^\s+|\s+$/g,""),s)},this._insertJS=(t,e,s)=>{var i="module"===s||"library"===s?e:`((loader, url, type) => { loader(url, type, (() => { return ${e}
})())})(${this._navimiLoaderNS}.${this._callBackNS}, "${t}", "${s}")`;this._loadedJSs[t]=e;const r=document.querySelector(`[jsUrl='${t}']`),n=(r&&r.remove(),document.createElement("script")),a=(n.type="module"===s?"module":"text/javascript",n.innerHTML=i,n.setAttribute("jsUrl",t),document.getElementsByTagName("head")[0]);(a||document.body).appendChild(n),"module"!==s&&"library"!==s||this._resolvePromise(!0,t)},this._getFunctions=(s,i)=>Object.freeze({addLibrary:this._addLibrary,setTitle:this._navimiHelpers.setTitle,navigateTo:window.navigateTo,getTemplate:this._navimiTemplates.getTemplate,fetchJS:t=>{const e=Array.isArray(t)?t:[t];return e.map(t=>{this._jsDepMap[t]=Object.assign(Object.assign({},this._jsDepMap[t]||{}),{[i]:!0})}),this.fetchJS(void 0,e,"javascript")},fetchTemplate:t=>this._navimiTemplates.fetchTemplate(void 0,t),style:this._navimiCSSs.style,setState:this._navimiState.setState,getState:this._navimiState.getState,setNavimiLinks:this._navimiHelpers.setNavimiLinks,unwatchState:t=>this._navimiState.unwatchState(s,t),watchState:(t,e)=>this._navimiState.watchState(s,t,e)}),this._getServices=async(t,e)=>{if(Array.isArray(e)){const i=e.filter(t=>"string"==typeof t);0<i.length&&this.loadServices(void 0,t,i)}const s=[];for(const r in this._jsDepMap)this._jsDepMap[r][t]&&s.push(r);await Promise.all(s.map(this._awaitJS));let i={};return null!=(e=this._servicesList[t])&&e.map(t=>{i=Object.assign(Object.assign({},i),{[t]:this._jsInstances[this._options.services[t]]})}),Object.freeze(i)},this._getClassAndServices=async(t,e)=>{let s=e;Array.isArray(e)&&(s=e.pop());t=await this._getServices(t,e);return{JsClass:s,services:t}},this._buildRoute=async(t,e)=>{const s=this,{JsClass:i,services:r}=await this._getClassAndServices(t,e),n="route:"+ ++this._uidCounter;return new class extends i{constructor(){super(s._getFunctions(n,t),r)}onEnter(t){super.onEnter&&super.onEnter(t)}onBeforeLeave(t){return!super.onBeforeLeave||super.onBeforeLeave(t)}onLeave(){super.onLeave&&super.onLeave()}destroy(){s._navimiState.unwatchState(n),super.destroy&&super.destroy()}}},this._buildComponentClass=async(e,t)=>{var s,i=Object.keys(this._options.components).find(t=>this._options.components[t]===e);if(i&&/-/.test(i))return{JsClass:t,services:s}=await this._getClassAndServices(e,t),this._navimiComponents.registerComponent(i,t,t=>this._getFunctions(t,e),s)},this._instantiateJS=async(e,t,s)=>{try{var i;return"route"===t||"component"===t?(i="route"===t?await this._buildRoute(e,s):await this._buildComponentClass(e,s),this._jsInstances[e]=i,this._resolvePromise(i,e)):(this._jsInstances[e]=s,this._resolvePromise(s,e))}catch(t){this._rejectPromise(t,e)}},this._isJsLoading=t=>void 0!==this._navimiLoader[this._promiseNS+t]&&!this._navimiFetch.getErrors(t),this._checkDepsUrls=(s,t,i)=>{const r=[];this._servicesList[s]||(this._servicesList[s]=[]);t=(t||[]).map(t=>{var e=this._options[i]&&this._options[i][t];return void 0===e?r.push(t):("services"===i&&-1===this._servicesList[s].indexOf(t)&&this._servicesList[s].push(t),this._jsDepMap[e]=Object.assign(Object.assign({},this._jsDepMap[e]||{}),{[s]:!0})),e});if(0<r.length)throw new Error(i+" not defined: "+r.join(", "));return t},this.isJsLoaded=t=>void 0!==this._loadedJSs[t],this.getInstance=t=>this._jsInstances[t],this.fetchJS=(i,t,r)=>{var e=s=>new Promise((t,e)=>this._jsInstances[s]?t(this._jsInstances[s]):!this._loadedJSs[s]||"module"!==r&&"library"!==r?this._isJsLoading(s)?this._awaitJS(s).then(t).catch(e):(this._navimiLoader[this._promiseNS+s]=t,this._navimiLoader[this._promiseNS+s+"_reject"]=e,void this._fetch(i,s,r).catch(e)):t(!0));return 1<t.length?Promise.all(t.map(e)):e(t[0])},this.loadServices=(e,t,s)=>{if(t){const i=this._checkDepsUrls(t,s,"services");t=i.filter(t=>void 0!==t).map(t=>this.fetchJS(e,[t],"service"));return Promise.all(t)}},this.loadComponents=(e,t,s)=>{if(t){const i=this._checkDepsUrls(t,s,"components");t=i.filter(t=>void 0!==t).map(t=>this.fetchJS(e,[t],"component"));return Promise.all(t)}},this.initRoute=async(t,e)=>{const s=this.getInstance(t);s&&s.onEnter&&await s.onEnter(e)}}init(t,e,s,i,r,n,a){this._navimiHelpers=t,this._navimiFetch=e,this._navimiCSSs=s,this._navimiTemplates=i,this._navimiState=r,this._navimiComponents=n,this._options=a,this._uidCounter=0,this._navimiLoader=window[this._navimiLoaderNS]={[this._callBackNS]:this._instantiateJS}}}class g{constructor(){this._templatesCache={},this._loadedTemplates={},this.loadTemplate=(t,e)=>{let s=t;if(this._regIni.exec(s))for(;t&&0<t.length;){var i=this._regIni.exec(s);if(!i||0===i.length)break;const n=this._regId.exec(i[1]);var r=0<n.length&&n[1].slice(1,-1),i=(s=s.substring(i.index+i[0].length),this._regEnd.exec(s));if(!r||!i||0===i.length)break;this._templatesCache[r]=s.substring(0,i.index)}else this._templatesCache[e]=s},this.isTemplateLoaded=t=>void 0!==this._loadedTemplates[t],this.getTemplate=t=>{const e=Array.isArray(t)?t:[t];t=e.map(t=>this._templatesCache[t]);return 1<t.length?t:t[0]},this.fetchTemplate=(t,e)=>{var s=e=>!e||this._loadedTemplates[e]?Promise.resolve():this._navimiFetch.fetchFile(e,{headers:{Accept:"text/html"},signal:t?t.signal:void 0}).then(t=>{this.loadTemplate(t,e),this._loadedTemplates[e]=!0});const i=Array.isArray(e)?e:[e];return 1<i.length?Promise.all(i.map(s)):s(i[0])}}init(t){this._navimiFetch=t,this._regIni=new RegExp("<t ([^>]+)>"),this._regEnd=new RegExp("</t>"),this._regId=new RegExp("id=(\"[^\"]+\"|'[^']+')")}}class f{constructor(){this._middlewareStack=[],this.addMiddlewares=t=>{Array.isArray(t)&&this._middlewareStack.push(...t.filter(t=>void 0!==t))},this.executeMiddlewares=async(n,e,a)=>{let o;const h=async(s,i,r=0)=>{o=r;const t=this._middlewareStack[r];if(t)try{await t(e,async(t,e)=>{n&&n.signal.aborted?s():t?(a(t,e),s()):await h(s,i,r+1)})}catch(t){i(t)}else s()};return new Promise(h)}}}class C{constructor(){this._state={},this._stateWatchers={},this._prevState={},this._stateDiff={},this._getStateDiff=t=>{t.sort((t,e)=>e.length-t.length).map(e=>{this._stateDiff[e]||this._navimiHelpers.stringify(this.getState(e,this._prevState)||"")!==this._navimiHelpers.stringify(this.getState(e,this._state)||"")&&(this._stateDiff[e]=!0,t.map(t=>{e!==t&&0===e.indexOf(t)&&(this._stateDiff[t]=!0)}))})},this._mergeState=(t,e)=>{e instanceof Error&&(e=Object.assign(Object.assign({},e),{message:e.message,stack:e.stack}));var s=t=>t&&"object"==typeof t&&!Array.isArray(t)&&null!==t;if(s(t)&&s(e))for(const i in e)s(e[i])?(t[i]||Object.assign(t,{[i]:{}}),this._mergeState(t[i],e[i])):Object.assign(t,{[i]:e[i]})},this.setState=t=>{var e=Object.keys(this._stateWatchers);0<e.length&&(this._prevState=this._navimiHelpers.cloneObject(this._state)),this._mergeState(this._state,t),0<e.length&&(this._getStateDiff(e),this._invokeStateWatchers())},this.getState=(t,e)=>{t=t?t.split(".").reduce((t,e)=>t&&t[e]||void 0,e||this._state):e||this._state;return t?Object.freeze(this._navimiHelpers.cloneObject(t)):void 0},this.watchState=(t,e,s)=>{e&&s&&(this._stateWatchers[e]||(this._stateWatchers[e]={}),this._stateWatchers[e]=Object.assign(Object.assign({},this._stateWatchers[e]),{[t]:[...this._stateWatchers[e][t]||[],s]}))},this.unwatchState=(e,t)=>{const s=t=>{this._stateWatchers[t][e]=void 0,delete this._stateWatchers[t][e],0===Object.keys(this._stateWatchers[t]).length&&delete this._stateWatchers[t]};if(t){const i=Array.isArray(t)?t:[t];void i.map(t=>{this._stateWatchers[t]||(this._stateWatchers[t]={}),s(t)})}else Object.keys(this._stateWatchers).map(s)},this.clear=t=>{const e=Array.isArray(t)?t:[t||""];e.map(e=>{const s=e?e.split(".").reduce((t,e)=>t&&t[e]||void 0,this._state):this._state;s instanceof Object&&Object.keys(s).map(t=>{s[t]instanceof Object&&0<Object.keys(s[t]).length&&this.clear((e?e+".":"")+t),delete s[t]})})}}init(t){this._navimiHelpers=t,this._invokeStateWatchers=t.debounce(()=>{const t=Object.keys(this._stateWatchers),e=Object.keys(this._stateDiff);this._stateDiff={},t.filter(t=>0<=e.indexOf(t)).sort((t,e)=>e.length-t.length).map(s=>{Object.keys(this._stateWatchers[s]).map(t=>{const e=this.getState(s);this._stateWatchers[s][t]&&this._stateWatchers[s][t].map(t=>t&&t(e))})})},10)}}class S{constructor(){}init(t,e,s,i){}}class b{constructor(){this.parseQuery=t=>{const e={};return t.split("&").map(t=>{t=t.split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1]||"")}),e},this.splitPath=t=>{if(!t)return[];var e=t.indexOf("?");return(t=0<=e?t.substring(0,e):t).split("/").filter(t=>0<t.length)},this.parsePath=(t,e)=>{var s=t.indexOf("?"),i=0<s?t.substring(s+1,t.length):"";const r=this.splitPath(t),n=this.splitPath(e);let a={};0<s&&(a={queryString:this.parseQuery(i)});for(let t=0;t<n.length;t++)if(":"===n[t].charAt(0)){var o=n[t].slice(1);if(r.length<=t)return null;a[o]=decodeURIComponent(r[t])}else if(!r[t]||n[t].toLowerCase()!==r[t].toLowerCase())return null;return a},this.debounce=(e,s)=>{let i;return function(...t){clearTimeout(i),i=setTimeout(()=>{i=null,e.apply(this,t)},s)}},this.throttle=(s,i,r)=>{let n,a;return function(...t){const e=Date.now();a&&e<a+i?(clearTimeout(n),n=setTimeout(()=>{a=e,s.apply(r,t)},i)):(a=e,s.apply(r,t))}},this.getUrl=()=>{const t=document.location;var e=t.toString().match(/^[^#]*(#.+)$/);const s=e?e[1]:"";return[t.pathname,t.search,s].join("")},this.setTitle=t=>{document.title=t},this.setNavimiLinks=()=>{document.querySelectorAll("[navimi-link]").forEach(t=>{t.removeAttribute("navimi-link"),t.addEventListener("click",t=>{t.preventDefault(),window.navigateTo(event.target.pathname)})})},this.removeHash=t=>{var e=t.indexOf("#");return 0<e?t.substring(0,e):t},this.stringify=t=>{const e=new Map;let i=0;const r=s=>{if("function"==typeof s)return String(s);if(s instanceof Error)return s.message;if(null===s||"object"!=typeof s)return s;if(e.has(s))return`[Circular: ${e.get(s)}]`;if(e.set(s,i++),Array.isArray(s))return t=s.map(r),e.delete(s),t;var t=Object.keys(s).reduce((t,e)=>(t[e]=r(((t,e)=>{if(Object.prototype.hasOwnProperty.call(t,e))try{return t[e]}catch(t){return}return t[e]})(s,e)),t),{});return e.delete(s),t};return JSON.stringify(r(t))},this.cloneObject=t=>null===t||"object"!=typeof t?t:t instanceof Error?new Error(t.message):Array.isArray(t)?t.map(this.cloneObject):Object.assign({},...Object.entries(t).map(([t,e])=>({[t]:this.cloneObject(e)}))),this.getRouteAndParams=(t,e)=>{var s=this.splitPath(t),i=e["*"];let r,n;for(const o in e){var a=this.splitPath(o);if(a.length===s.length&&(n=this.parsePath(t,o))){r=e[o];break}}return!r&&i&&(n=this.parsePath(t,t),r=i),{routeItem:r,params:n}},this.getNodeType=t=>{switch(t.nodeType){case Node.TEXT_NODE:return"text";case Node.COMMENT_NODE:return"comment";default:return t.tagName.toLowerCase()}},this.getNodeContent=t=>0<t.childNodes.length?null:t.textContent,this.mergeHtmlElement=(t,e,s)=>{var i;{if(!(0<e.childNodes.length)||t.childNodes.length)return!e.childNodes.length&&t.childNodes.length?(s(t,i=document.createDocumentFragment()),void e.appendChild(i)):void(0<t.childNodes.length&&s(t,e));e.innerHTML=""}},this.syncAttributes=(t,s)=>{if(t.tagName.toLowerCase()===s.tagName.toLowerCase()){const i=[].slice.call(s.attributes),r=[].slice.call(t.attributes);t=r.filter(e=>{var t=i.find(t=>e.name===t.name);return t&&e.value!==t.value});const n=i.filter(e=>!r.some(t=>e.name===t.name));var e=r.filter(e=>!i.some(t=>e.name===t.name));n.forEach(t=>{s.removeAttribute(t.name)}),[...t,...e].forEach(({name:t,value:e})=>{s.setAttribute(t,e)})}}}}class y{constructor(){this._components={},this._uidCounter=0,this._removeComponent=t=>{t.localName&&!t.__removed&&this._components[t.localName]&&(t.__removed=!0,this._navimiState.unwatchState(t.__uid),this._removeChildComponents(t),this._disconnectComponent(t),t.remove(),t.onUnmount&&t.onUnmount())},this._disconnectComponent=e=>{e.parentComponent&&(e.parentComponent.childComponents=e.parentComponent.childComponents.filter(t=>t!==e))},this._removeChildComponents=t=>{t.childComponents&&t.childComponents.map(t=>{this._removeComponent(t)})},this._readAttributes=s=>{var t=s.props;return s.props={},[].slice.call(s.attributes).map(t=>{var e=t.name;"function"!=typeof s[e]&&(s.props=Object.assign(Object.assign({},s.props||{}),{[e]:t.value}))}),t},this._traverseComponentsTree=(t,e)=>{t.localName&&(this._components[t.localName]?e(t):[].slice.call(t.childNodes).map(t=>{this._traverseComponentsTree(t,e)}))},this._registerTag=(t,e)=>{if(!t.props&&this._components[t.localName]){const s=this._components[t.localName],i=(t.props={},t.parentComponent=void 0,t.childComponents=[],this._findParentComponent(t,e),this._readAttributes(t),new s(t));i.init()}},this._findParentComponent=(e,t)=>{var s=t=>{(e.parentComponent=t).childComponents=[...t.childComponents||[],e]};if(t)s(t);else{let t=e.parentNode;for(;t;){if(/-/.test(t.localName)&&this._components[t.localName])return void s(t);t=t.parentNode}}},this._bindChildEvents=(e,s)=>{s.attributes&&[].slice.call(s.attributes).map(t=>{t=t.name;"function"==typeof s[t]&&(s[t]=s[t].bind(e))})},this._registerChildNodes=e=>{const s=t=>{[].slice.call(t.childNodes).map(t=>{this._components[t.localName]||(this._bindChildEvents(e,t),s(t))})};s(e)},this._mergeHtml=(e,s)=>{var i=[].slice.call(e.childNodes);const r=[].slice.call(s.childNodes);let n=r.length-i.length;var a,o,h=i.length,e=r.length;for(let t=0;t<h;t++){const l=i[t],c=r[t];c?this._navimiHelpers.getNodeType(l)!==this._navimiHelpers.getNodeType(c)?0<n?(this._traverseComponentsTree(c,this._removeComponent),c.parentNode&&c.parentNode.removeChild(c),t--,n--):s.insertBefore(l.cloneNode(!0),c):(a=this._navimiHelpers.getNodeContent(l),o=this._navimiHelpers.getNodeContent(c),a&&a!==o&&(c.textContent=a),l.localName&&(this._navimiHelpers.syncAttributes(l,c),this._components[l.localName]||this._navimiHelpers.mergeHtmlElement(l,c,this._mergeHtml))):s.appendChild(l.cloneNode(!0))}n=e-h;for(let t=e-1;t>=h;t--)this._traverseComponentsTree(r[t],this._removeComponent),r[t].parentNode&&r[t].parentNode.removeChild(r[t]),n--;this._registerChildNodes(s)},this.registerComponent=(t,s,i,r)=>{if(t&&/-/.test(t)){i=i||(()=>{});const n=this;Object.setPrototypeOf(s.prototype,HTMLElement.prototype);var e=class{constructor(t){this.init=async()=>{await this.render(),this._component.onMount&&await this._component.onMount.call(this._node)},this.render=async()=>{var t=this._component.render&&await this._component.render.call(this._node,this._initalInnerHTML);if(t&&t!==this._previousTemplate){this._previousTemplate=t;const e=(new DOMParser).parseFromString(t,"text/html");n._mergeHtml(e.querySelector("body"),this._node)}this._component.onRender&&this._component.onRender.call(this._node)};var e="component:"+n._uidCounter++;this._node=t,this._previousTemplate=void 0,this._initalInnerHTML=t.innerHTML,t.innerHTML="",this._component=new s(this._node.props,i(e),r),this._component.__uid=e,Object.setPrototypeOf(this._node,this._component),this._component.update=n._navimiHelpers.throttle(this.render,16,this._node)}};return this._components[t]=e}}}init(t,e){this._navimiHelpers=t,this._navimiState=e,new window.MutationObserver(t=>{t.forEach(t=>{if("attributes"===t.type){const s=t.target;var e;this._components[s.localName]&&(e=this._readAttributes(s),s.shouldUpdate&&!s.shouldUpdate(e,s.props)||s.update&&s.update())}else[].slice.call(t.addedNodes).map(t=>{this._traverseComponentsTree(t,this._registerTag)}),[].slice.call(t.removedNodes).map(t=>{this._traverseComponentsTree(t,this._removeComponent)})})}).observe(document,{childList:!0,subtree:!0,attributes:!0})}}return class{constructor(t,e,s,i){let{navimiFetch:r,navimiCSSs:n,navimiJSs:a,navimiTemplates:o,navimiMiddlewares:h,navimiState:l,navimiHot:c,navimiHelpers:m,navimiComponents:_}=s||{};r=r||new p,n=n||new u,a=a||new v,o=o||new g,h=h||new f,l=l||new C,c=c||new S,m=m||new b,(_=_||new y).init(m,l),r.init(e),n.init(r),a.init(m,r,n,o,l,_,e),o.init(r),l.init(m);s={navimiFetch:r,navimiJSs:a,navimiCSSs:n,navimiTemplates:o,navimiMiddlewares:h,navimiState:l,navimiHot:c,navimiHelpers:m,navimiComponents:_};i?i(t,s,e):new d(t,s,e)}}}();