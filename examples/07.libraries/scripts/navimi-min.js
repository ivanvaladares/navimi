/**
 * Navimi v0.1.1 
 * Developed by Ivan Valadares 
 * ivanvaladares@hotmail.com 
 * https://github.com/ivanvaladares/navimi 
 */ 
var __Navimi_CSSs,__Navimi_Dom,__Navimi_Fetch,__Navimi_Helpers,__Navimi_Hot,__Navimi_JSs,__Navimi_Middleware,__Navimi_State,__Navimi_Templates;!function(e){const c={};e.isCssLoaded=e=>void 0!==c[e],e.getCss=e=>c[e],e.fetchCss=(r,s,a)=>new Promise(async(e,t)=>{if(!s||c[s])return e();try{var i=await __Navimi_Fetch.fetchFile(s,{headers:{Accept:"text/css"},signal:r?r.signal:void 0});a?(__Navimi_Dom.insertCss(i,s,!0),c[s]="loaded"):c[s]=i,e()}catch(e){t(e)}}),e.reloadCss=(e,t,i,r,s)=>{const a=__Navimi_Helpers.isSameFile;if(a(s,e))return console.log(e+" updated."),c[s]=t,void __Navimi_Dom.insertCss(t,"globalCss");for(const l in i){var{jsUrl:o,cssUrl:n}=i[l];if(a(n,e))return console.log(e+" updated."),c[n]=t,void(r===o&&__Navimi_Dom.insertCss(t,"routeCss"))}}}(__Navimi_CSSs=__Navimi_CSSs||{});const INCLUDEHOT=!0,EXCLUDEHOT=!1;!function(e){e.setTitle=e=>{document.title=e},e.setNavimiLinks=t=>{document.querySelectorAll("[navimi-link]").forEach(e=>{e.removeAttribute("navimi-link"),e.setAttribute("navimi-linked",""),e.addEventListener("click",e=>{e.preventDefault(),t(e.target.pathname)})})},e.insertCss=(e,t,i)=>{const r=t?document.querySelector(`[cssId='${t}']`):void 0;if(r&&r.remove(),e){const s=document.createElement("style");s.innerHTML=e,t&&s.setAttribute("cssId",t);const a=document.getElementsByTagName("head")[0]||document.body;i?a.prepend(s):a.appendChild(s)}},e.insertJS=(e,t)=>{const i=document.querySelector(`[jsUrl='${t}']`),r=(i&&i.remove(),document.createElement("script")),s=(r.type="text/javascript",r.innerHTML=e,r.setAttribute("jsUrl",t),document.getElementsByTagName("head")[0]);(s||document.body).appendChild(r)},e.addLibrary=async e=>{let t=Array.isArray(e)?e:[e];0<(t=t.filter(e=>!__Navimi_JSs.isJsLoaded(e))).length&&await Promise.all(t.map(e=>{const t=e.split(".").pop();if("css"!==t.toLowerCase())return __Navimi_JSs.fetchJS(void 0,[e]);__Navimi_CSSs.fetchCss(void 0,e,!0)})).catch(e=>{throw new Error(e)})}}(__Navimi_Dom=__Navimi_Dom||{}),function(a){let o;a.loadErrors={},a.init=e=>{o=e.bustCache},a.fetchFile=(s,t)=>new Promise((i,r)=>{delete a.loadErrors[s];var e=s+(o?"?v="+o:"");fetch(e,t).then(async e=>{var t;if(!e||!e.ok)return a.loadErrors[s]=t="Could not load the file! - "+s,r(t);i(await e.text())}).catch(e=>{a.loadErrors[s]=e.message,r(e)})})}(__Navimi_Fetch=__Navimi_Fetch||{}),function(r){const l=e=>{if(!e)return[];var t=e.indexOf("?");return(e=0<=t?e.substr(0,t):e).split("/").filter(e=>0<e.length)},c=(e,t)=>{var i=e.indexOf("?"),r=0<i?e.substr(i+1,e.length):"";const s=l(e),a=l(t);let o={};0<i&&(o={queryString:(e=>{const t={};return e.split("&").map(e=>{e=e.split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"")}),t})(r)});for(let e=0;e<a.length;e++)if(":"===a[e].charAt(0)){var n=a[e].slice(1);if(s.length<=e)return null;o[n]=decodeURIComponent(s[e])}else if(!s[e]||a[e].toLowerCase()!==s[e].toLowerCase())return null;return o};r.isSameFile=(e,t)=>e&&t&&e.split("?").shift().toLowerCase()==t.split("?").shift().toLowerCase(),r.timeout=t=>new Promise(e=>setTimeout(e,t)),r.debounce=(e,t)=>{let i;return function(){clearTimeout(i),i=setTimeout(()=>{i=null,e.apply(this,arguments)},t)}},r.getUrl=()=>{const e=document.location;var t=e.toString().match(/^[^#]*(#.+)$/);const i=t?t[1]:"";return[e.pathname,e.search,i].join("")},r.removeHash=e=>{var t=e.indexOf("#");return 0<t?e.substr(0,t):e},r.stringify=e=>{const t=[],r=i=>{if("function"==typeof i)return String(i);if(i instanceof Error)return i.message;if(null===i||"object"!=typeof i)return i;if(-1!==t.indexOf(i))return`[Circular: ${t.indexOf(i)}]`;if(t.push(i),Array.isArray(i))return e=i.map(r),t.pop(),e;var e=Object.keys(i).reduce((e,t)=>(e[t]=r(((e,t)=>{if(Object.prototype.hasOwnProperty.call(e,t))try{return e[t]}catch(e){return}return e[t]})(i,t)),e),{});return t.pop(),e};return JSON.stringify(r(e))},r.cloneObject=i=>null===i||"object"!=typeof i?i:Object.keys(i).reduce((e,t)=>(null!==i[t]&&"object"==typeof i[t]?e[t]=r.cloneObject(i[t]):e[t]=i[t],e),Array.isArray(i)?[]:{}),r.getRouteAndParams=(e,t)=>{var i=l(e),r=t["*"];let s,a;for(const n in t){var o=l(n);if(o.length===i.length&&(a=c(e,n))){s=t[n];break}}return{routeItem:s=!s&&r?r:s,params:a}}}(__Navimi_Helpers=__Navimi_Helpers||{}),function(e){e.openHotWs=(e,t)=>{}}(__Navimi_Hot=__Navimi_Hot||{}),function(n){const s="__navimiLoader",a="_jsLoaderCallback",c="_promise_",_={},m={},d={},v={},l={};let h,p,u;const f=(e,t,i)=>{var r=void 0!==i?`(function(){window.${s}.${a}("${e}", ${i}, (function(){return ${t}   
            })())}())`:t;_[e]=!!i||t,__Navimi_Dom.insertJS(r,e)},t=async(i,e,r)=>{const s=h[c+i],t=h[c+i+"_reject"];if(setTimeout(()=>{delete h[c+i],delete h[c+i+"_reject"]},10),e)return m[i]=r,void(s&&s(Object.freeze(r)));try{__Navimi_State.unwatchState(i);var a=Object.freeze({addLibrary:__Navimi_Dom.addLibrary,setTitle:__Navimi_Dom.setTitle,navigateTo:p,getTemplate:__Navimi_Templates.getTemplate,fetchJS:e=>{const t=Array.isArray(e)?e:[e];return t.map(e=>{v[e]=Object.assign(Object.assign({},v[e]||{}),{[i]:!0})}),n.fetchJS(void 0,t,!0)},fetchTemplate:e=>{e=Array.isArray(e)?e:[e];return __Navimi_Templates.fetchTemplate(void 0,e,i)},setState:__Navimi_State.setState,getState:__Navimi_State.getState,setNavimiLinks:()=>__Navimi_Dom.setNavimiLinks(p),unwatchState:e=>__Navimi_State.unwatchState(i,e),watchState:(e,t)=>__Navimi_State.watchState(i,e,t)});let t;if(l[i]&&0<l[i].length){for(;;){if(-1===l[i].map(e=>void 0===m[u.services[e]]).indexOf(!0))break;if(l[i].map(e=>u.services[e]).find(e=>__Navimi_Fetch.loadErrors[e]))return;await __Navimi_Helpers.timeout(10)}l[i].map(e=>{t=Object.assign(Object.assign({},t),{[e]:m[u.services[e]]})})}var o=new r(a,t);d[i]=o,s&&s(o)}catch(e){t&&t(e)}};n.init=e=>{p=e.navigateTo,u=e.options,h=window[s]={_jsLoaderCallback:t}},n.isJsLoaded=e=>void 0!==_[e],n.getInstance=e=>d[e],n.fetchJS=(n,e,l)=>{var t=i=>new Promise(async(e,t)=>{return l&&m[i]?e(m[i]):d[i]?e(d[i]):h[c+i]?(r=i,void await new Promise((e,t)=>{const i=setInterval(()=>d[r]?(clearInterval(i),e(d[r])):void 0===h[c+r]?(clearInterval(i),t("Error loading file! "+r)):void 0,50)}).then(e).catch(t)):(h[c+i]=e,h[c+i+"_reject"]=t,s=n,a=i,o=l,void new Promise(async(t,i)=>{try{let e;e="string"==typeof _[a]?_[a]:await __Navimi_Fetch.fetchFile(a,{headers:{Accept:"application/javascript"},signal:s?s.signal:void 0}),f(a,e,o),void 0===o&&h[c+a](!0),t()}catch(e){i(e)}}).catch(e=>{h[c+i+"_reject"](e)}));var r,s,a,o});return 1<e.length?Promise.all(e.map(t)):t(e[0])},n.loadServices=(t,r,e)=>{if(r&&e&&0!==e.length&&(l[r]=l[r]||[],e&&0<e.length)){let i=[];const s=e.map(e=>{var t=u.services&&u.services[e];return void 0===t?i.push(e):(-1===l[r].indexOf(e)&&l[r].push(e),v[t]=Object.assign(Object.assign({},v[t]||{}),{[r]:!0})),t});if(0<i.length)throw new Error("Service(s) not defined: "+i.join(", "));Promise.all(s.filter(e=>void 0!==e).map(e=>n.fetchJS(t,[e],!0)))}},n.initJS=async(e,t)=>{const i=n.getInstance(e);i&&i.init&&await i.init(t)},n.reloadJs=(e,t,i,r,s)=>{const a=__Navimi_Helpers.isSameFile;for(const o in i){const n=i[o]["jsUrl"];if(a(n,e))return console.log(e+" updated."),delete d[n],h[c+n]=()=>{n===r&&s()},void f(n,t,!1)}for(const l in v)a(l,e)&&(console.log(e+" updated."),delete m[l],h[c+l]=()=>{Object.keys(v[l]).map(e=>{delete d[e],e===r&&s()})},f(e,t,!0))}}(__Navimi_JSs=__Navimi_JSs||{}),function(e){const c=[];e.addMiddlewares=e=>{Array.isArray(e)&&c.push(...e.filter(e=>void 0!==e))},e.executeMiddlewares=async(a,t,o)=>{let n=-1;const l=async(i,r,s=0)=>{s===n&&console.warn("next() called multiple times"),n=s;const e=c[s];e?await e(t,async(e,t)=>{a.signal.aborted?r():e?(r(),o(e,t)):await l(i,r,s+1)}):i()};await new Promise(await l).catch(e=>{})}}(__Navimi_Middleware=__Navimi_Middleware||{});class Navimi{constructor(e,t){this.navigateTo=(e,t)=>{this.initRoute(e,t)},this.reportError=e=>{this.options.onError?this.options.onError(e):console.error(e)},this.initRoute=async(e,t,_)=>{var i=__Navimi_Helpers.removeHash(e||__Navimi_Helpers.getUrl());if(!_){if(this.currentUrl===i)return;this.abortController.abort(),this.abortController=new AbortController}var r=++this.callId,m=void 0!==e;let{routeItem:s,params:a}=__Navimi_Helpers.getRouteAndParams(i,this.routesList);if((void 0!==t&&(a=Object.assign(Object.assign({},a),t)),this.options.onBeforeRoute)&&!1===await this.options.onBeforeRoute({url:i,routeItem:s,params:a},this.navigateTo))return;if(this.currentJS&&!_){const c=__Navimi_JSs.getInstance(this.currentJS);if(c){const p=c.beforeLeave;if(p)if(!1===p({url:i,routeItem:s,params:a}))return void(m||history.forward());c.destroy&&c.destroy()}}if(s)if(await __Navimi_Middleware.executeMiddlewares(this.abortController,{url:i,routeItem:s,params:a},(e,t)=>{this.initRoute(e,t,!0)}),r<this.callId)console.warn("Navimi: A middleware has called navigateTo()");else{this.currentUrl=i;try{var{title:d,jsUrl:o,cssUrl:n,templatesUrl:l,dependsOn:v}=s||{};if(!o&&!l)throw new Error("The route must define the 'jsUrl' or 'templatesUrl'!");o&&(this.currentJS=o,this.routesParams[o]={url:i,routeItem:s,params:a}),m&&(null!=t&&t.replaceUrl?history.replaceState(null,null,e):history.pushState(null,null,e)),__Navimi_CSSs.fetchCss(this.abortController,n).catch(e=>{}),__Navimi_Templates.fetchTemplate(this.abortController,[l]).catch(e=>{});try{__Navimi_JSs.loadServices(this.abortController,o,v)}catch(e){this.reportError(e)}for(o&&await __Navimi_JSs.fetchJS(this.abortController,[o],!1);n&&!__Navimi_CSSs.isCssLoaded(n)||l&&!__Navimi_Templates.isTemplateLoaded(l)||this.options.globalCssUrl&&!__Navimi_CSSs.isCssLoaded(this.options.globalCssUrl)||this.options.globalTemplatesUrl&&!__Navimi_Templates.isTemplateLoaded(this.options.globalTemplatesUrl);){if(await __Navimi_Helpers.timeout(10),r<this.callId)return;if(n&&__Navimi_Fetch.loadErrors[n]||l&&__Navimi_Fetch.loadErrors[l]||this.options.globalCssUrl&&__Navimi_Fetch.loadErrors[this.options.globalCssUrl]||this.options.globalTemplatesUrl&&__Navimi_Fetch.loadErrors[this.options.globalTemplatesUrl])return void this.reportError(new Error(__Navimi_Fetch.loadErrors[n]||__Navimi_Fetch.loadErrors[l]||__Navimi_Fetch.loadErrors[this.options.globalCssUrl]||__Navimi_Fetch.loadErrors[this.options.globalTemplatesUrl]))}__Navimi_Dom.setTitle(d);try{if(!o){var h=__Navimi_Templates.getTemplate(l);const u=document.querySelector("body");return void(h&&u&&(u.innerHTML=h))}await __Navimi_JSs.initJS(o,this.routesParams[o])}catch(e){this.reportError(e)}finally{if(r<this.callId)return;__Navimi_Dom.setNavimiLinks(this.navigateTo),__Navimi_Dom.insertCss(__Navimi_CSSs.getCss(n),"routeCss"),this.options.onAfterRoute&&this.options.onAfterRoute({url:i,routeItem:s,params:a},this.navigateTo)}}catch(e){this.reportError(e)}}else r===this.callId&&this.reportError(new Error("No route match for url: "+i))},this.callId=0,this.abortController=new AbortController,this.currentJS=void 0,this.currentUrl=void 0,this.routesParams={},this.routesList=e||{},this.options=t||{},this.win=window||{},this.win.addEventListener("popstate",()=>{this.initRoute()}),this.win.navigateTo=this.navigateTo,__Navimi_JSs.init({navigateTo:this.navigateTo.bind(this),options:this.options}),__Navimi_Fetch.init(this.options),__Navimi_Middleware.addMiddlewares(this.options.middlewares),(async()=>{(this.options.globalCssUrl||this.options.globalTemplatesUrl)&&(await Promise.all([__Navimi_CSSs.fetchCss(void 0,this.options.globalCssUrl),__Navimi_Templates.fetchTemplate(void 0,[this.options.globalTemplatesUrl])]).catch(this.reportError),__Navimi_Dom.insertCss(__Navimi_CSSs.getCss(this.options.globalCssUrl),"globalCss"))})(),this.initRoute(),this.options.hot&&console.warn("HOT is disabled! Use the unminified version to enable it.")}}!function(r){const s={},a={};let o={},n={};const l=__Navimi_Helpers.debounce(()=>{const e=Object.keys(a),t=Object.keys(n);n={},e.filter(e=>t.includes(e)).sort((e,t)=>t.length-e.length).map(i=>{Object.keys(a[i]).map(e=>{const t=r.getState(i);a[i][e]&&a[i][e].map(e=>e&&e(t))})})},10),c=(e,t)=>{t instanceof Error&&(t=Object.assign(Object.assign({},t),{message:t.message,stack:t.stack}));var i=e=>e&&"object"==typeof e&&!Array.isArray(e)&&null!==e;if(i(e)&&i(t))for(const r in t)i(t[r])?(e[r]||Object.assign(e,{[r]:{}}),c(e[r],t[r])):Object.assign(e,{[r]:t[r]})};r.setState=e=>{var i,t=Object.keys(a);0<t.length&&(o=__Navimi_Helpers.cloneObject(s)),c(s,e),0<t.length&&((i=t).sort((e,t)=>t.length-e.length).map(t=>{n[t]||__Navimi_Helpers.stringify(r.getState(t,o)||"")!==__Navimi_Helpers.stringify(r.getState(t,s)||"")&&(n[t]=!0,i.map(e=>{t!==e&&0===t.indexOf(e)&&(n[e]=!0)}))}),l())},r.getState=(e,t)=>{e=e?e.split(".").reduce((e,t)=>e&&e[t]||void 0,t||s):t||s;return e?Object.freeze(__Navimi_Helpers.cloneObject(e)):void 0},r.watchState=(e,t,i)=>{t&&i&&(a[t]||(a[t]={}),a[t]=Object.assign(Object.assign({},a[t]),{[e]:[...a[t][e]||[],i]}))},r.unwatchState=(t,e)=>{const i=e=>{a[e][t]=void 0,delete a[e][t],0===Object.keys(a[e]).length&&delete a[e]};if(e){const r=Array.isArray(e)?e:[e];void r.map(e=>{a[e]||(a[e]={}),i(e)})}else Object.keys(a).map(i)}}(__Navimi_State=__Navimi_State||{}),function(e){let l={},a={},m={};const d=(e,t)=>{const i=new RegExp("<t ([^>]+)>"),r=new RegExp("</t>"),s=new RegExp('id="([^"]+)"');let a=e;if(i.exec(a))for(;e&&0<e.length;){var o=i.exec(a);if(!o||0===o.length)break;var n=s.exec(o[1]),n=0<n.length&&n[1],o=(a=a.substr(o.index+o[0].length),r.exec(a));if(!n||!o||0===o.length)break;l[n]=a.substr(0,o.index)}else l[t]=a};e.isTemplateLoaded=e=>void 0!==a[e],e.getTemplate=e=>{const t=Array.isArray(e)?e:[e];e=t.map(e=>l[e]);return 1<e.length?e:e[0]},e.fetchTemplate=(s,e,t)=>{var i=r=>new Promise(async(e,t)=>{if(!r||a[r])return e();try{var i=await __Navimi_Fetch.fetchFile(r,{headers:{Accept:"text/html"},signal:s?s.signal:void 0});d(i,r),a[r]=!0,e()}catch(e){t(e)}});return t&&e.map(e=>{m[e]=Object.assign(Object.assign({},m[e]||{}),{[t]:!0})}),1<e.length?Promise.all(e.map(i)):i(e[0])},e.reloadTemplate=(e,t,i,r,s,a)=>{const o=__Navimi_Helpers.isSameFile;if(o(s,e))return console.log(e+" updated."),d(t,s),void a();for(const l in i){var{jsUrl:_,templatesUrl:n}=i[l];if(o(n,e))return console.log(e+" updated."),d(t,n),void(r===_&&a())}for(const c in m)o(c,e)&&(console.log(e+" updated."),d(t,c),Object.keys(m[c]).map(e=>{e===r&&a()}))}}(__Navimi_Templates=__Navimi_Templates||{});